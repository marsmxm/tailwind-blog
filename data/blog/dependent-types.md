---
title: 'ä¾èµ–ç±»å‹ä¸å®šç†è¯æ˜'
date: '2019-06-09T23:56:13+08:00'
draft: false
tags: ['dependent type', 'idris', 'pie', 'coq']
authors: ['default']
---

## ä»€ä¹ˆæ˜¯ä¾èµ–ç±»å‹

ä¼ ç»Ÿçš„é™æ€ç±»å‹è¯­è¨€å¯¹ç±»å‹å’Œå€¼æœ‰æ˜ç¡®çš„åŒºåˆ†ï¼Œå¯¹äºç±»å‹ä¿¡æ¯å¯ä»¥å‡ºç°åœ¨å“ªä¹Ÿæœ‰ä¸¥æ ¼çš„é™åˆ¶ã€‚è€Œåœ¨æ”¯æŒä¾èµ–ç±»å‹ï¼ˆdependent typeï¼‰çš„è¯­è¨€é‡Œï¼Œç±»å‹å’Œå€¼ä¹‹é—´çš„ç•Œé™å˜å¾—æ¨¡ç³Šï¼Œç±»å‹å¯ä»¥åƒå€¼ä¸€æ ·è¢«è®¡ç®—ï¼ˆå³æ‰€è°“çš„ first-class ç±»å‹ [^1]ï¼‰ï¼ŒåŒæ—¶å€¼ä¹Ÿå¯ä»¥å‡ºç°åœ¨ç±»å‹ä¿¡æ¯é‡Œï¼Œâ€œä¾èµ–â€ä¸¤ä¸ªå­—æŒ‡çš„å°±æ˜¯ç±»å‹å¯ä»¥ä¾èµ–äºå€¼ã€‚å› æ­¤ç±»å‹å’Œå€¼ä¹‹é—´ä¸å†æ˜¯å•å‘çš„è€Œå˜æˆäº†åŒå‘çš„æè¿°å…³ç³»ã€‚æ”¯æŒä¾èµ–ç±»å‹çš„å¥½å¤„ä¸€æ˜¯ç±»å‹ç³»ç»Ÿå˜å¾—æ›´åŠ å¼ºå¤§ï¼Œå¯ä»¥æ£€æµ‹å¹¶é˜»æ­¢æ›´å¤šçš„é”™è¯¯ç±»å‹ï¼Œè®©ç¨‹åºæ›´å¯é ï¼›äºŒæ˜¯ä¾èµ–ç±»å‹å¯ä»¥è®©è®¡ç®—æœºåƒè¿è¡Œä¼ ç»Ÿçš„ç¨‹åºä¸€æ ·æ¥è¿è¡Œæ•°å­¦è¯æ˜ [^2]ï¼Œä»è€Œåœ¨é€»è¾‘ä¸Šä¿è¯ç¨‹åºå…³é”®å±æ€§çš„æˆç«‹ã€‚

ä¸ºäº†å¯¹ä¾èµ–ç±»å‹æœ‰ä¸€ä¸ªç›´è§‚çš„æ„Ÿå—ï¼Œä¸¾ä¸€ä¸ªå‡æƒ³çš„ä¾‹å­ã€‚å‡å¦‚ Java ä¸­åŠ å…¥äº†å¯¹ä¾èµ–ç±»å‹çš„æ”¯æŒï¼Œé‚£ä¹ˆä»¥ Java çš„æ•°ç»„ç±»å‹ä¸ºä¾‹ï¼Œå¯ä»¥è®©å®ƒåŒ…å«æ›´å¤šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ•°ç»„çš„é•¿åº¦ï¼š

```java
String[3] threeNames = {"å¼ ä¸‰", "èµµå››", "æˆå‰æ€æ±—"}; // è™šæ„çš„è¯­æ³•
```

è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ï¼Œæ‰€æœ‰å›´ç»•äºæ•°ç»„ç±»å‹çš„æ–¹æ³•ç°åœ¨éƒ½å¯ä»¥åœ¨ç±»å‹ä¿¡æ¯ä¸­åŒ…å«æ›´å…·ä½“çš„å¯¹è¡Œä¸ºçš„æè¿°ã€‚æ¯”å¦‚åˆå¹¶ä¸¤ä¸ªæ•°ç»„çš„å‡½æ•°`concat`çš„ç­¾åå¯ä»¥å†™æˆï¼š

```java
String[n + m] concat(String[n] start, String[m] end) {...} // è™šæ„çš„è¯­æ³•
```

è¿™é‡Œé€šè¿‡ç±»å‹å°±å¯ä»¥çŸ¥é“`concat`è¿”å›çš„æ•°ç»„çš„é•¿åº¦æ˜¯ä¸¤ä¸ªå‚æ•°æ•°ç»„é•¿åº¦çš„å’Œã€‚è¿™æ ·ä¸ä»…ç¨‹åºå˜å¾—æ›´æ˜“è¯»ï¼Œæ‰€æœ‰å¯ä»¥å€Ÿç”±æ•°ç»„é•¿åº¦åæ˜ å‡ºæ¥çš„ç¨‹åºé”™è¯¯éƒ½èƒ½åœ¨è¿è¡Œå‰è¢«æ£€æµ‹å‡ºæ¥ï¼ˆåé¢ä¼šæœ‰å®ä¾‹è¯´æ˜ï¼‰ã€‚å†ä¸¾ä¸€ä¸ª first-class ç±»å‹çš„ä¾‹å­ï¼Œä¸‹é¢æ˜¯ç”¨ [Idris](https://www.idris-lang.org/) å†™çš„ä¸€ä¸ªç¨‹åºç‰‡æ®µï¼ŒIdris æ˜¯ä¸€ä¸ªæ”¯æŒä¾èµ–ç±»å‹ã€å’Œ Haskell éå¸¸æ¥è¿‘çš„è¯­è¨€ã€‚

```idris
StringOrInt : Bool -> Type
StringOrInt x = case x of
  True => Int
  False => String

getStringOrInt : (x : Bool) -> StringOrInt x
getStringOrInt x = case x of
  True => 42
  False => "Fourty two"

valToString : (x : Bool) -> StringOrInt x -> String
valToString x val = case x of
  True => cast val
  False => val
```

è¿™æ®µç¨‹åºçš„ç¬¬ 1ã€6ã€11 è¡Œåˆ†åˆ«å£°æ˜äº†ä¸‰ä¸ªå‡½æ•°`StringOrInt`ã€`getStringOrInt`å’Œ`valToString`çš„ç±»å‹ã€‚`StringOrInt`æ¥å—ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼çš„ç±»å‹æ˜¯`Type`ï¼ˆä¹Ÿå°±æ˜¯**ç±»å‹çš„ç±»å‹**ï¼Œå› ä¸ºç±»å‹ä¹Ÿæ˜¯ä¸€ç§å€¼ï¼‰ï¼Œå½“å‚æ•°æ˜¯`True`ï¼Œè¿”å›`Int`ç±»å‹ï¼Œå‚æ•°ä¸º`False`æ—¶ï¼Œè¿”å›`String`ç±»å‹ã€‚è€Œåœ¨`getStringOrInt`çš„ç±»å‹å£°æ˜ä¸­å¯ä»¥çœ‹åˆ°å®ƒçš„è¿”å›å€¼ç±»å‹æ˜¯`StringOrInt x`ï¼Œä¹Ÿå°±æ˜¯è¯´è¿”å›å€¼ç±»å‹ä¾èµ–äºå‚æ•°`x`çš„å€¼ï¼šå½“`x`çš„å€¼ä¸º`True`æ—¶ï¼Œè¿”å›å€¼ç±»å‹æ˜¯`StringOrInt True`çš„å€¼ï¼Œä¹Ÿå°±æ˜¯`Int`ï¼›å½“`x`æ˜¯`False`æ˜¯ï¼Œè¿”å›å€¼ç±»å‹å°±å˜æˆäº†`String`ã€‚å‡½æ•°`StringOrInt`å’Œ`getStringOrInt`ä½“ç°äº†ä¾èµ–ç±»å‹çš„ä¸¤ä¸ªç‰¹æ€§ï¼š

1. ç±»å‹å¯ä»¥ç”±å‡½æ•°åŠ¨æ€åœ°è®¡ç®—å‡ºæ¥ã€‚
2. ç±»å‹å£°æ˜ä¸­å¯ä»¥åŒ…æ‹¬å˜é‡æˆ–è€…å¤æ‚çš„è¡¨è¾¾å¼ï¼Œå¦‚`StringOrInt x`ï¼Œæœ€åå®é™…çš„ç±»å‹å–å†³äºæ‰€ä¾èµ–çš„å€¼ã€‚

æœ€åä¸€ä¸ªå‡½æ•°`valToString`çš„ç±»å‹å’Œ`getStringOrInt`çš„ç±»ä¼¼ï¼ŒåŒºåˆ«åªåœ¨äºå®ƒçš„ç¬¬äºŒä¸ªå‚æ•°ç±»å‹ï¼ˆè€Œä¸æ˜¯è¿”å›å€¼ç±»å‹ï¼‰ä¾èµ–äºå‚æ•°`x`çš„å€¼ã€‚å¦‚æœ`x`æ˜¯`True`ï¼Œå‚æ•°`val`çš„ç±»å‹å°±æ˜¯`Int`ï¼Œåˆå› ä¸ºè¿”å›å€¼ç±»å‹æ˜¯`String`ï¼Œæ‰€ä»¥éœ€è¦ç”¨`cast`å‡½æ•°åšä¸€ä¸ªç±»å‹è½¬æ¢ï¼›è‹¥`x`ç­‰äº`False`ï¼Œå‚æ•°`val`çš„ç±»å‹å’Œè¿”å›å€¼ç±»å‹ä¸€è‡´ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ã€‚

æœ‰äº†ä¸€ä¸ªç›´è§‚çš„æ„Ÿå—åï¼Œä¸ºäº†æ›´è¯¦ç»†å‡†ç¡®åœ°é˜é‡Šä¾èµ–ç±»å‹ä»¥åŠåŸºäºä¾èµ–ç±»å‹çš„å®šç†è¯æ˜ï¼Œæœ¬æ–‡ä¼šå›´ç»•ä¸€ä¸ªå«åš [Pie](https://github.com/the-little-typer/pie) çš„è¯­è¨€è¿›è¡Œä¸‹å»ã€‚Pie æ˜¯ä¸ºäº† Friedman å’Œ Christiansen çš„[ã€ŠThe Little Typerã€‹](http://thelittletyper.com/)è¿™æœ¬ä¹¦è€Œè¢«å¼€å‘å‡ºæ¥çš„åŒ…å«ä¾èµ–ç±»å‹æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½çš„ä¸€ä¸ªå°å·§ç®€æ´ï¼ˆå®Œæ•´çš„[å‚è€ƒæ‰‹å†Œ](https://docs.racket-lang.org/pie/index.html)åªæœ‰ä¸åˆ° 3000 å­—ï¼‰çš„è¯­è¨€ã€‚

### å‡†å¤‡å·¥ä½œ

Pie æ˜¯ä¸€ä¸ªç”¨ [Racket](https://racket-lang.org/) å¼€å‘çš„è¯­è¨€ï¼Œæ‰€ä»¥å®ƒçš„å¼€å‘ç¯å¢ƒä¹Ÿæ˜¯åŸºäº DrRacketã€‚å…·ä½“çš„å®‰è£…æ­¥éª¤å¾ˆç®€å•ï¼Œå¯ä»¥å‚ç…§[å®˜æ–¹ç½‘ç«™](http://thelittletyper.com)ä¸Šçš„æŒ‡ç¤ºã€‚è¿™é‡Œè¯´å‡ ä¸ªè®©å¼€å‘ç¯å¢ƒæ›´æ˜“ç”¨çš„è®¾ç½®ã€‚ä¸€æ˜¯ DrRacket å®‰è£…æˆåŠŸåå¯ä»¥åœ¨ View èœå•è®¾ç½®ä¸€ä¸‹ layout å’Œ toolbarï¼š

![conf-layout](/static/images/dt/conf1.png)
![conf-toolbar](/static/images/dt/conf2.png)

ä¸‹å›¾æ˜¯è®¾ç½®ä¹‹åçš„ç•Œé¢å¸ƒå±€ã€‚å·¦å³ä¸¤ä¸ªç¼–è¾‘åŒºåŸŸåˆ†åˆ«æ˜¯å®šä¹‰å’Œäº¤äº’åŒºï¼Œå·¥å…·æ åœ¨æœ€å³ä¾§å‚ç›´æ’åˆ—ã€‚åœ¨å®šä¹‰åŒºè¾“å…¥å˜é‡ã€å‡½æ•°å®šä¹‰ç­‰ç¨‹åºçš„ä¸»ä½“éƒ¨åˆ†åï¼Œç‚¹å‡»å·¥å…·æ çš„ç»¿è‰²ç®­å¤´ï¼ˆæˆ–è€…æŒ‰å¿«æ·é”® âŒ˜-R æˆ– Ctrl-Rï¼‰æ¥è¿è¡Œï¼Œè¿™æ—¶å³ä¾§çš„äº¤äº’åŒºå°±å˜æˆä¸€ä¸ªåŸºäºå½“å‰ç¨‹åºçš„ REPL ç¯å¢ƒã€‚

![racket-pref](/static/images/dt/whole.png)

å†æœ‰å°±æ˜¯å¯ä»¥æ‰“å¼€ DrRacket çš„ Preferences ç•Œé¢ï¼ˆâŒ˜-, æˆ– Ctrl-,ï¼‰ï¼Œå°† Background expansion è®¾ç½®æˆ "with gold highlighting"ï¼š

![racket-pref](/static/images/dt/conf3.png)

è¿™æ ·å°±å¯ä»¥æ›´å®¹æ˜“åœ°å®šä½åˆ°ç¨‹åºä¸­æœ‰é—®é¢˜çš„éƒ¨åˆ†ï¼š

![err1](/static/images/dt/err1.png)

### Pie è¯­è¨€ç®€ä»‹

Pie çš„è¯­æ³•ç±»ä¼¼äº Lisp çš„å„ç§æ–¹è¨€ï¼ˆSchemeï¼ŒRacket å’Œ Clojure ç­‰ï¼‰ï¼Œä¹Ÿå°±æ„å‘³ç€ç¨‹åºä¸­æ‹¬å·çš„æ•°é‡ä¼šæ¯”è¾ƒå¯è§‚ã€‚åœ¨ Pie è¯­è¨€é‡Œï¼Œæ¯ä¸ªå˜é‡æˆ–å‡½æ•°åœ¨å®šä¹‰å‰éƒ½å¿…é¡»å£°æ˜ç±»å‹ï¼š

```pie
(claim age
  Nat)
(define age
  18)
```

è¿™é‡Œæ˜¯å…ˆå£°æ˜å˜é‡`age`çš„ç±»å‹ä¸ºè‡ªç„¶æ•°`Nat`ï¼Œå†æŠŠå®ƒçš„å€¼å®šä¹‰ä¸º`18`ã€‚Pie çš„å‡ ä¸ªåŸºç¡€ç±»å‹åˆ†åˆ«æ˜¯ï¼Œ

- è‡ªç„¶æ•°`Nat`ã€‚è¡¨ç¤ºæ‰€æœ‰å¤§äºç­‰äº 0 çš„æ•´æ•°ã€‚
- åŸå­`Atom`ã€‚ç›¸å½“äº Lisp ä¸­çš„ symbol ç±»å‹ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ç²—ç•¥çš„è¿‘ä¼¼äºå¤§éƒ¨åˆ†è¯­è¨€é‡Œçš„å­—ç¬¦ä¸²ã€‚`Atom`çš„å€¼ç”±å•æ’‡å·å’Œä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯æˆ–è¿å­—ç¬¦ç»„æˆï¼Œä¾‹å¦‚`'abc`ï¼Œ`'---`å’Œ`'Atom`ã€‚
- å‡½æ•°`(-> Type-1 Type-2 ... Type-n)`ã€‚è¿™é‡Œæœ€åçš„`Type-n`æ˜¯å‡½æ•°çš„è¿”å›å€¼ç±»å‹ï¼Œå…¶ä»–çš„`Type-1 Type-2 ...`æ˜¯å‚æ•°ç±»å‹ã€‚
- å…¨é›†`U`ã€‚å› ä¸ºåœ¨ Pie é‡Œæ‰€æœ‰çš„ç±»å‹å¯ä»¥åƒå€¼ä¸€æ ·è¢«è®¡ç®—å’Œä¼ é€’ï¼Œæ‰€ä»¥å®ƒä»¬æœ¬èº«ä¹Ÿéœ€è¦ä¸€ä¸ªç±»å‹ï¼Œè¿™ä¸ªç±»å‹å°±æ˜¯`U`ã€‚`U`æ˜¯é™¤è‡ªèº«å¤–æ‰€æœ‰ç±»å‹çš„ç±»å‹ã€‚

è¿˜æœ‰ä¸€äº›å¤åˆç±»å‹ä¼šåœ¨åé¢ç”¨åˆ°çš„æ—¶å€™å†ä½œè¯¦ç»†è§£é‡Šã€‚Pie çš„æ¯ä¸ªç±»å‹éƒ½æœ‰å¯¹åº”çš„ constructor å’Œ eliminatorã€‚å‰è€…ç”¨æ¥æ„é€ è¯¥ç±»å‹çš„å€¼ï¼›åè€…çš„ç”¨å¤„æ˜¯**è¿ç”¨è¯¥ç±»å‹çš„å€¼æ‰€åŒ…å«çš„ä¿¡æ¯æ¥å¾—åˆ°æ‰€éœ€è¦çš„æ–°å€¼**ï¼Œå¦‚æœæŠŠæŸç§ç±»å‹çš„å€¼çœ‹ä½œä¸€ä¸ªç½å¤´çš„è¯ï¼Œé‚£å®ƒå¯¹åº”çš„ eliminator å°±åƒä¸€ä¸ªèµ·å­ï¼Œè€Œä¸”ä¸åŒæ„é€ çš„ç½å¤´éœ€è¦ç”¨åˆ°ä¸ä¸€æ ·çš„èµ·å­ã€‚

#### å‡½æ•°

å‡½æ•°çš„ constructor æ‹¥æœ‰å¦‚ä¸‹ç»“æ„ï¼š

```pie
(lambda (x1 x2 ...)
  e1 e2 ...)
```

`x1 x2 ...`æ˜¯å‡½æ•°çš„å‚æ•°ï¼Œ`e1 e2 ...`æ˜¯ä½œä¸ºå‡½æ•°ä½“çš„ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼ï¼Œå‡½æ•°ä½“çš„æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼åŒæ—¶ä¹Ÿæ˜¯å‡½æ•°çš„è¿”å›å€¼ã€‚å¦å¤–`lambda`å…³é”®å­—ä¹Ÿå¯ä»¥ç”¨å¸Œè…Šå­—æ¯`Î»`æ¥ä»£æ›¿ [^3]ï¼Œè®©ç¨‹åºçœ‹èµ·æ¥æ›´ç®€æ´ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„å‡½æ•°å®šä¹‰ç¤ºä¾‹ï¼š

```pie
(claim echo
  (-> Atom
    Atom))
(define echo
  (Î» (any-atom)
    any-atom))
```

è¿™é‡Œå…ˆæ˜¯å£°åè¿™ä¸ªå‡½æ•°çš„ç±»å‹ï¼šæ¥å—ä¸€ä¸ª`Atom`ç±»å‹çš„å€¼ä½œä¸ºå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ª`Atom`ç±»å‹çš„å€¼ã€‚æ¥ç€å°±æ˜¯å‡½æ•°`echo`çš„å…·ä½“å®šä¹‰ï¼šæ— è®ºä¼ å…¥ä»€ä¹ˆ`Atom`éƒ½åŸæ ·è¿”å›ã€‚å¯¹äºå‡½æ•°æ¥è¯´ eliminator åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯å¯¹å‡½æ•°çš„è°ƒç”¨ï¼Œåªèƒ½å€Ÿç”±è¿™å”¯ä¸€çš„é€”å¾„æ¥ä½¿ç”¨å®šä¹‰å¥½çš„å‡½æ•°ã€‚å‡½æ•°çš„è°ƒç”¨è¯­æ³•æ˜¯ï¼Œ`(å‡½æ•°åæˆ–åŒ¿åå‡½æ•° å‚æ•°1 å‚æ•°2 ...)`ï¼š

```pie
> (echo 'ä½ å¥½)
(the Atom 'ä½ å¥½)
```

ä»¥`>`å¼€å¤´çš„ä¸€è¡Œè¡¨ç¤ºè¿™æ˜¯åœ¨äº¤äº’åŒºè¾“å…¥çš„å†…å®¹ï¼Œä¸‹é¢ç´§è·Ÿç€çš„æ˜¯è¿™è¡Œè¿è¡Œåå¾—åˆ°çš„å€¼ã€‚`'ä½ å¥½`å‰é¢çš„`the Atom`æ˜¯å¯¹è¿™ä¸ªå€¼çš„ç±»å‹æ³¨è§£ã€‚å¯¹äºåœ¨äº¤äº’åŒºè¾“å…¥çš„è¡¨è¾¾å¼ï¼ŒPie éƒ½ä¼šä»¥ (the ç±»å‹ å€¼) çš„å½¢å¼æ¥æ˜¾ç¤ºå®ƒçš„å€¼ï¼š

```pie
> 18
(the Nat 18)
```

å¦å¤–ï¼Œ(the ç±»å‹ ...) è¡¨è¾¾å¼ä¹Ÿå¯ä»¥ç”¨æ¥åœ¨è§£é‡Šå™¨æ— æ³•åˆ¤æ–­å½“å‰è¡¨è¾¾å¼çš„ç±»å‹çš„æƒ…å†µä¸‹ç»™äºˆè§£é‡Šå™¨ä¸€ä¸ªæç¤ºï¼š
![example-the](/static/images/dt/ex1.png)

#### Atom

å¯¹äº`Atom`æ¥è¯´æ‰€æœ‰ç¬¦åˆè§„åˆ™çš„å€¼éƒ½æ˜¯ä¸€ä¸ª constructorï¼Œè€Œä¸”`Atom`æ²¡æœ‰å¯¹åº”çš„ eliminatorï¼Œå› ä¸ºæ¯ä¸ªå€¼æœ¬èº«å°±æ˜¯å®ƒçš„æ„ä¹‰æ‰€åœ¨ã€‚

#### Nat

è‡ªç„¶æ•°`Nat`çš„ constructor æ˜¯`zero`å’Œ`add1`ã€‚`zero`é¡¾åæ€ä¹‰å¾—åˆ°çš„æ˜¯æœ€å°è‡ªç„¶æ•°é›¶ï¼Œè€Œ`add1`æ¥å—ä¸€ä¸ªè‡ªç„¶æ•°`n`ä½œä¸ºå‚æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªæ¯”`n`å¤§`1`çš„è‡ªç„¶æ•°ã€‚æ‰€ä»¥è‡ªç„¶æ•° 1ã€2ã€3 å¯ä»¥åˆ†åˆ«è¡¨ç¤ºæˆ`(add1 zero)`ã€`(add1 (add1 zero))`ã€`(add1 (add1 (add1 zero)))`ã€‚å¦‚æœç”¨å½’çº³æ³•æ¥å®šä¹‰`Nat`çš„è¯ï¼Œå¯ä»¥å†™ä½œï¼š

```code
Nat ::= zero
Nat ::= (add1 Nat)
```

ç”¨è¿™ç§æ–¹å¼å®šä¹‰å‡ºæ¥çš„è‡ªç„¶æ•°åˆå«åš[çš®äºšè¯ºæ•°ï¼ˆPeano numberï¼‰](https://wiki.haskell.org/Peano_numbers)ã€‚å½“ç„¶è¿™ç§è¡¨ç¤ºæ–¹å¼å†™èµ·æ¥æœ‰äº›ç¹çï¼Œæ‰€ä»¥ Pie ä¹Ÿæä¾›äº†æ›´ä¾¿æ·çš„è¯­æ³•ï¼šå¯ä»¥ç›´æ¥æŠŠè‡ªç„¶æ•°å†™ä½œæ•°å­—ï¼Œä¾‹å¦‚`zero`å’Œ`0`ã€`(add1 (add1 zero))`å’Œ`2`éƒ½æ˜¯ç­‰ä»·çš„ã€‚å¯¹äºè‡ªç„¶æ•°ï¼Œ Pie æä¾›äº†å¤šä¸ªå¯ä¾›ä½¿ç”¨çš„ eliminatorã€‚å…·ä½“ä½¿ç”¨å“ªä¸ªå–å†³äºè¦è§£å†³çš„é—®é¢˜ã€‚æ¯”å¦‚å®šä¹‰ä¸€ä¸ªç±»å‹ä¸º`(-> Nat Nat)`çš„å‡½æ•°`pred`ï¼Œè§„å®šå®ƒå¯¹äºè‡ªç„¶æ•°`0`è¿”å›`0`ï¼Œå¯¹äºå…¶ä»–è‡ªç„¶æ•°è¿”å›æ¯”è‡ªèº«å°ä¸€çš„æ•°ï¼š

```pie
(claim pred
  (-> Nat
    Nat))
(define pred
  (Î» (n)
    (which-Nat n
      0
      (Î» (n-1)
        n-1))))
```

å‡½æ•°`pred`ç”¨åˆ°çš„ eliminator æ˜¯ [which-Nat](https://docs.racket-lang.org/pie/index.html#%28def._%28%28lib._pie%2Fmain..rkt%29._which-.Nat%29%29)ã€‚`which-Nat`çš„ä½¿ç”¨æ–¹å¼æ˜¯`(which-Nat target base step)`ï¼Œå®ƒçš„å€¼ç”±`target`ã€`base`å’Œ`step`ä¸‰ä¸ªå‚æ•°å†³å®šã€‚å¦‚æœç”¨`X`æŒ‡ä»£`which-Nat`çš„è¿”å›å€¼ç±»å‹ï¼Œé‚£ä¹ˆ`target`çš„ç±»å‹æ˜¯`Nat`ï¼Œ`base`çš„ç±»å‹æ˜¯`X`ï¼Œè€Œ`step`æ˜¯ä¸€ä¸ªç±»å‹ä¸º`(-> Nat X)`çš„å‡½æ•°ã€‚
![which-Nat](/static/images/dt/which-Nat.png)
å½“`target`ç­‰äº`0`æ—¶ï¼Œ`base`çš„å€¼å³ä¸ºæ•´ä¸ª`which-Nat`è¡¨è¾¾å¼çš„å€¼ï¼›å¦‚æœ`target`ä¸ä¸º`0`æˆ–è€…è¯´`target`å¯ä»¥è¡¨ç¤ºæˆå½¢å¦‚`(add1 n-1)`çš„è‡ªç„¶æ•°ï¼ˆè¿™é‡Œçš„`n-1`æ˜¯ä¸€ä¸ªæ™®é€šçš„æ ‡è¯†ç¬¦ï¼Œä¸æ˜¯`n`å‡`1`çš„è¡¨è¾¾å¼ï¼‰ï¼Œè¿™æ—¶`which-Nat`çš„å€¼ç­‰äº`step`å‡½æ•°ä½œç”¨äº`n-1`ï¼ˆå³æ¯”`target`å°`1`çš„è‡ªç„¶æ•°ï¼‰æ‰€å¾—åˆ°çš„å€¼ã€‚

åœ¨ä¸Šè¿°å‡½æ•°`pred`ä¸­ï¼Œ`which-Nat`çš„`target`æ˜¯`pred`çš„å‚æ•°`n`ï¼Œ`base`æ˜¯`0`ï¼Œ`step`æ˜¯å‡½æ•°`(Î» (n-1) n-1)`ã€‚æ‰€ä»¥å½“`n`ç­‰äº`0`æ—¶ï¼Œ`which-Nat`è¿”å›`base`çš„å€¼ï¼Œ`0`ï¼›å½“`n`å¤§äº`0`æˆ–è€…è¯´`n`ç­‰äº`(add1 n-1)`æ—¶ï¼Œ`which-Nat`è¿”å›çš„å°±æ˜¯`(step n-1)`çš„å€¼ï¼Œå³å‚æ•°`n-1`æœ¬èº«ã€‚

```pie
> (pred 10086)
(the Nat 10085)
> (pred 0)
(the Nat 0)
```

å¦‚æœç†Ÿæ‚‰æ‰€è°“çš„å‡½æ•°å¼è¯­è¨€ï¼Œå¯ä»¥çœ‹å‡ºæ¥`which-Nat`å…¶å®å°±æ˜¯è¿™äº›è¯­è¨€é‡Œçš„ pattern matchingï¼ˆè™½ç„¶å¹¶ä¸å®Œå…¨ç­‰åŒï¼Œåè¾¹ä¼šè¯´åˆ°åŒºåˆ«ï¼‰ã€‚å¦‚æœç”¨ Idris å®ç°`pred`çš„è¯ï¼Œä¼šæ˜¯è¿™ä¸ªæ ·å­ï¼š

```idris
pred : Nat -> Nat
pred Z = Z
pred (S k) = k
```

åœ¨ Idris é‡Œï¼Œ`Z`å’Œ`S`åˆ†åˆ«æ˜¯`Nat`ç±»å‹çš„ä¸¤ä¸ª constructorï¼Œç­‰åŒäº Pie é‡Œçš„`zero`å’Œ`add1`ã€‚åä¸¤è¡Œçš„ä¸¤ä¸ª pattern matching çš„åˆ†æ”¯ä¹Ÿå¯¹åº”äº`which-Nat`çš„`base`å’Œ`step`ã€‚å‰é¢è¯´åˆ°çš„`which-Nat`å’Œ pattern matching çš„åŒºåˆ«æŒ‡çš„æ˜¯ï¼Œåœ¨å¸¸è§„çš„ pattern matching ä¸­å¯ä»¥å¯¹å‡½æ•°é€’å½’è°ƒç”¨ï¼Œè€Œ Pie å¹¶ä¸å…è®¸ç”¨æˆ·å®šä¹‰çš„å‡½æ•°å¯¹è‡ªèº«çš„é€’å½’è°ƒç”¨ï¼Œè¿™ä¸ªé™åˆ¶çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯ [**total**](https://en.wikipedia.org/wiki/Partial_function#Total_function) çš„ã€‚ä¸¾å®ç°è‡ªç„¶æ•°åŠ æ³•è¿ç®—çš„å‡½æ•°ä¸ºä¾‹ï¼Œåœ¨æ”¯æŒé€’å½’è°ƒç”¨çš„è¯­è¨€æ¯”å¦‚ Idris ä¸­å¯ä»¥è¿™æ ·å®ç°ï¼ˆé€’å½’åœ¨æœ€åä¸€è¡Œï¼‰ï¼š

```idris
plus : Nat -> Nat -> Nat
plus Z m = m
plus (S k) m = S (plus k m)
```

å¦‚æœ Pie å…è®¸å‡½æ•°çš„é€’å½’è°ƒç”¨ï¼Œå®Œå…¨å¯ä»¥ç”¨`which-Nat`å®ç°åŒæ ·çš„é€»è¾‘ï¼š

```pie
(claim +
  (-> Nat Nat
    Nat))
(define +
  (Î» (n m)
    (which-Nat n
      m
      (Î» (n-1)
        (add1 (+ n-1 m)))))) ; é”™è¯¯: Unknown variable +
```

ä¸å¹¸çš„æ˜¯å¦‚æœæŠŠä¸Šé¢è¿™æ®µç¨‹åºè¾“å…¥åˆ°å®šä¹‰åŒºåŸŸï¼ŒDrRacket ä¼šåœ¨æœ€åä¸€è¡Œæç¤º â€œUnknown variable +â€ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½æ”¹æˆä½¿ç”¨â€œå†…ç½®äº†é€’å½’â€çš„ eliminatorï¼Œ[rec-Nat](https://docs.racket-lang.org/pie/index.html#%28def._%28%28lib._pie%2Fmain..rkt%29._rec-.Nat%29%29)ã€‚`rec-Nat`å’Œ`which-Nat`ç±»ä¼¼ï¼Œæ¥å—çš„ä¸‰ä¸ªå‚æ•°ä¹Ÿæ˜¯`target`ã€`base`å’Œ`step`ï¼Œè€Œä¸”å½“`target`ç­‰äº`0`æ—¶åŒæ ·æŠŠ`base`ä½œä¸ºè‡ªèº«çš„å€¼è¿”å›ã€‚
![rec-Nat](/static/images/dt/rec-Nat.png)
ä¸åŒçš„æ˜¯`rec-Nat`çš„`step`å‚æ•°ç±»å‹æ˜¯`(-> Nat X X)`ã€‚å½“`target`å¯ä»¥è¡¨ç¤ºæˆ`(add1 n-1)`çš„éé›¶è‡ªç„¶æ•°æ—¶ï¼Œ`step`çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯`n-1`å’Œ`(rec-Nat n-1 base step)`ã€‚ä¹Ÿå°±æ˜¯è¯´`rec-Nat`å†…ç½®äº†å¯¹è‡ªèº«çš„é€’å½’è°ƒç”¨ï¼Œä½œä¸º`rec-Nat`çš„ä½¿ç”¨è€…åªéœ€è¦çŸ¥é“`step`çš„**ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¯”å½“å‰çš„éé›¶`target`å°ä¸€çš„è‡ªç„¶æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ç­‰äºæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ–°çš„`target`ä¼ é€’ç»™é€’å½’çš„`rec-Nat`æ‰€å¾—åˆ°çš„å€¼**ã€‚

ç”¨`rec-Nat`æ¥å®ç°`+`å‡½æ•°åŒæ ·å¯ä»¥æŠŠ`n`ä½œä¸º`target`ï¼Œ`n`ç­‰äº`0`æ—¶`base`çš„å€¼åº”è¯¥ä¸º`m`ï¼Œå› ä¸º`(+ 0 m)`ç­‰äº`m`ï¼š

```pie
(claim +
  (-> Nat Nat
    Nat))
(define +
  (Î» (n m)
    (rec-Nat n
      m
      TODO)))
```

å› ä¸ºè¿˜æ²¡æœ‰å†³å®š`step`å¦‚ä½•å®ç°ï¼Œå¯ä»¥åœ¨å®ƒçš„ä½ç½®ä¸Šæš‚æ—¶å†™ä¸Š`TODO`ã€‚åœ¨ Pie é‡Œå¯ä»¥ç”¨`TODO`æ›¿ä»£ç¨‹åºä¸­å°šæœªå®ç°çš„éƒ¨åˆ†ï¼ŒPie è¿˜å¯ä»¥æç¤ºæ¯ä¸ª`TODO`åº”è¯¥æ˜¯ä»€ä¹ˆç±»å‹ã€‚å¦‚æœè¿è¡Œä¸Šé¢çš„ç¨‹åºç‰‡æ®µï¼Œä¼šå¾—åˆ°å’Œ`TODO`ç›¸å…³çš„ä¿¡æ¯ï¼š

```code
 n : Nat
 m : Nat
------------
 (â†’ Nat Nat
   Nat)
```

æ¨ªçº¿ä¸Šé¢çš„`n`å’Œ`m`æ˜¯å½“å‰`TODO`æ‰€åœ¨çš„ scope é‡Œæ‰€æœ‰çš„å˜é‡ç±»å‹ï¼Œä¸‹é¢æ˜¯å®ƒæœ¬èº«çš„ç±»å‹ã€‚ä»`rec-Nat`çš„å®šä¹‰å¯ä»¥çŸ¥é“`TODO`ä»£è¡¨çš„`step`å‡½æ•°æ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¯”`n`å°ä¸€çš„è‡ªç„¶æ•°ï¼ˆå› ä¸º`n`æ˜¯`target`ï¼‰ï¼Œå¯ä»¥å–åä¸º`n-1`ï¼›å¦ä¸€ä¸ªå‚æ•°æ˜¯æŠŠ`n-1`ä½œä¸ºæ–°çš„`target`æ—¶é€’å½’è°ƒç”¨`rec-Nat`çš„ç»“æœï¼Œå…¶å®ä¹Ÿå°±æ˜¯`n-1`ä¸`m`çš„å’Œï¼Œæ‰€ä»¥å¯ä»¥å–å`n-1+m`ï¼š

```pie
(define +
  (Î» (n m)
    (rec-Nat n
      m
      (Î» (n-1 n-1+m)
        TODO))))
```

æ­¤æ—¶`TODO`çš„ç±»å‹å˜ä¸ºäº†ï¼š

```code
     n : Nat
     m : Nat
   n-1 : Nat
 n-1+m : Nat
-------------
 Nat
```

ä»è¿™ä¸ªç±»å‹æè¿°å¯ä»¥çŸ¥é“`step`å‡½æ•°ä½“å¿…é¡»æ˜¯ä¸€ä¸ªå€¼ç±»å‹ä¸º`Nat`çš„è¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼çš„å€¼ä¹Ÿæ˜¯æœ€ç»ˆçš„ç»“æœï¼Œ`n`ä¸`m`çš„å’Œã€‚ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†`n-1`ä¸`m`çš„å’Œï¼Œæƒ³å¾—åˆ°`n`åŠ `m`çš„è¯å½“ç„¶å°±æ˜¯æŠŠ`n-1+m`å‚æ•°åŠ ä¸€ï¼š

```pie
(define +
  (Î» (n m)
    (rec-Nat n
      m
      (Î» (n-1 n-1+m)
        (add1 n-1+m)))))
```

è¿™æ ·å°±å¾—åˆ°äº†å®Œæ•´çš„`+`å‡½æ•°çš„å®šä¹‰ã€‚ä¸ºäº†åŠ æ·±å¯¹`rec-Nat`çš„ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸‹è§£é‡Šå™¨å¯¹`(+ 2 1)`çš„æ±‚å€¼è¿‡ç¨‹ã€‚å½“è§£é‡Šå™¨é‡åˆ°è¡¨è¾¾å¼`(+ 2 1)`æ—¶ï¼Œé¦–å…ˆä¼šåˆ¤æ–­è¿™æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æŠŠå‡½æ•°åæ›¿æ¢æˆå®é™…çš„å‡½æ•°å®šä¹‰ï¼š

```pie
((Î» (n m)
    (rec-Nat n
      m
      (Î» (n-1 n-1+m)
        (add1 n-1+m))))
 2 1)
```

ç„¶åå°†å‡½æ•°ä½“ä¸­çš„`n`å’Œ`m`åˆ†åˆ«æ›¿æ¢æˆ`2`å’Œ`1`ï¼š

```pie
(rec-Nat 2
  1
  (Î» (n-1 n-1+m)
    (add1 n-1+m)))
```

å› ä¸º`target`ç­‰äºéé›¶è‡ªç„¶æ•°`2`ï¼Œä¹Ÿå°±æ˜¯`(add1 1)`ï¼Œæ‰€ä»¥`rec-Nat`çš„å€¼å°±ç­‰äºå¯¹`step`å‡½æ•°è°ƒç”¨åçš„å€¼ï¼ˆå°†`step`çš„å‡½æ•°ä½“`(add1 n-1+m)`ä¸­çš„`n-1+m`æ›¿æ¢æˆå¯¹`rec-Nat`çš„é€’å½’è°ƒç”¨ï¼‰ï¼š

```pie
(add1
  (rec-Nat 1
    1
    (Î» (n-1 n-1+m)
      (add1 n-1+m))))
```

è¿™æ—¶å†…å±‚çš„`rec-Nat`çš„`target`å‚æ•°ç­‰äº`(add1 zero)`ä»ç„¶ä¸ä¸ºé›¶ï¼Œæ‰€ä»¥ç»§ç»­å°†`rec-Nat`è¡¨è¾¾å¼æ›¿æ¢æˆè°ƒç”¨`step`æ‰€å¾—åˆ°çš„å€¼ï¼š

```pie
(add1
  (add1
    (rec-Nat 0
      1
      (Î» (n-1 n-1+m)
        (add1 n-1+m)))))
```

ç°åœ¨æœ€é‡Œå±‚çš„`rec-Nat`çš„`target`ç­‰äº`0`ï¼Œæ‰€ä»¥å®ƒçš„å€¼å°±ç­‰äº`base`çš„å€¼`1`:

```pie
(add1
  (add1
    1))
```

è¿™æ ·å°±å¾—åˆ°äº†æœ€åçš„ç»“æœ`3`ã€‚

#### æŸ¯é‡ŒåŒ–

è™½ç„¶å‰é¢ä»‹ç»å‡½æ•°æ—¶è¯´å‡½æ•°æ˜¯å¯ä»¥æ¥å—å¤šä¸ªå‚æ•°çš„ï¼ˆ`(lambda (x1 x2 ...) e1 e2 ...)`ï¼‰ï¼Œä½†å…¶å®æœ¬è´¨ä¸Š Pie çš„å‡½æ•°åªæ¥å—ä¸€ä¸ªå‚æ•°ã€‚ä¹‹æ‰€ä»¥å¯ä»¥å®šä¹‰å‡ºæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°ï¼Œæ˜¯å› ä¸º Pie çš„è§£é‡Šå™¨ä¼šå¯¹å‡½æ•°ä½œä¸€ä¸ªå«åš [æŸ¯é‡ŒåŒ–ï¼ˆcurryingï¼‰](https://en.wikipedia.org/wiki/Currying) çš„å¤„ç†ã€‚æ¯”å¦‚è¿™å››ä¸ªå‡½æ•°ï¼š

```pie
;; æ¥å—ä¸¤ä¸ª Atom å‚æ•°ï¼Œè¿”å›å€¼ç±»å‹ä¸º Atom
;; å£°æ˜ç±»å‹å’Œå‡½æ•°å®šä¹‰çš„å½¢å¼ä¸€è‡´
(claim currying-test1
  (-> Atom Atom
    Atom))
(define currying-test1
  (Î» (a b)
    b))

;; å£°æ˜ç±»å‹åŒä¸Š
;; å£°æ˜ç±»å‹å’Œå‡½æ•°å®šä¹‰çš„å½¢å¼ä¸ä¸€è‡´
(claim currying-test2
  (-> Atom Atom
    Atom))
(define currying-test2
  (Î» (a)
    (Î» (b)
      b)))

;; æ¥å—ä¸€ä¸ª Atom å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªç±»å‹ä¸º (-> Atom Atom) çš„å‡½æ•°
;; å£°æ˜ç±»å‹å’Œå‡½æ•°å®šä¹‰çš„å½¢å¼ä¸ä¸€è‡´
(claim currying-test3
  (-> Atom
    (-> Atom
      Atom)))
(define currying-test3
  (Î» (a b)
    b))

;; å£°æ˜ç±»å‹åŒä¸Š
;; å£°æ˜ç±»å‹å’Œå‡½æ•°å®šä¹‰çš„å½¢å¼ä¸€è‡´
(claim currying-test4
  (-> Atom
    (-> Atom
      Atom)))
(define currying-test4
  (Î» (a)
    (Î» (b)
      b)))
```

è¿™å‡ ä¸ªå‡½æ•°æ— è®ºæ˜¯å¦æœ‰å£°æ˜ç±»å‹ä¸Šçš„å·®å¼‚ï¼Œè¿˜æ˜¯å£°æ˜å’Œå®šä¹‰å½¢å¼æ˜¯å¦ä¸€è‡´ï¼Œåœ¨ Pie çš„è§£é‡Šå™¨çœ‹æ¥éƒ½æ˜¯å®Œå…¨ç›¸åŒçš„ï¼š

```pie
> currying-test1
(the (â†’ Atom Atom
       Atom)
  (Î» (a b)
    b))

> currying-test2
(the (â†’ Atom Atom
       Atom)
  (Î» (a b)
    b))

> currying-test3
(the (â†’ Atom Atom
       Atom)
  (Î» (a b)
    b))

> currying-test4
(the (â†’ Atom Atom
       Atom)
  (Î» (a b)
    b))
```

çŸ¥é“äº†è¿™ä¸€ç‚¹æˆ‘ä»¬å°±å¯ä»¥è¿ç”¨æ‰€è°“çš„ [partial application](https://en.wikipedia.org/wiki/Partial_application) ä»å·²æœ‰çš„å‡½æ•°ç”Ÿæˆå‡ºå…¶ä»–â€œå›ºå®šâ€äº†æŸäº›å‚æ•°çš„å€¼çš„æ–°å‡½æ•°ã€‚æ¯”å¦‚å¯ä»¥ä»å‰è¿°çš„åŠ æ³•å‡½æ•°`+`å¾—åˆ°æŠŠå‚æ•°åŠ ä¸€çš„æ–°å‡½æ•°ï¼š

```pie
(claim plus-one
  (-> Nat
    Nat))
(define plus-one
  (+ 1))

> (plus-one 2)
(the Nat 3)
```

ç”¨äº†æ¯”è¾ƒé•¿çš„ç¯‡å¹…æ¥ä»‹ç» Pie çš„å‡ ä¸ªåŸºç¡€ç±»å‹ï¼Œæ¥ä¸‹æ¥å¯ä»¥è¯´ä¸€è¯´ Pie è¯­è¨€é‡Œçš„å‡ ç§ä¾èµ–ç±»å‹äº†ã€‚

### ä¾èµ–äºç±»å‹çš„ç±»å‹ï¼šList

å¦‚æœç†Ÿæ‚‰ Java çš„æ³›å‹ï¼ˆgenericsï¼‰æˆ–è€… ML çš„å¤šæ€ï¼ˆpolymorphismï¼‰çš„è¯ï¼Œåº”è¯¥ä¼šå¾ˆå®¹æ˜“ç†è§£ Pie çš„ [List](https://docs.racket-lang.org/pie/index.html#%28part._.Lists%29) ç±»å‹ã€‚åœ¨ Pie ä¸­ï¼Œè‹¥`E`æ˜¯ä¸€ä¸ªç±»å‹åˆ™`(List E)`æ˜¯ä¸€ä¸ª List ç±»å‹ï¼Œä»£è¡¨ä¸€ç±»å…ƒç´ ç±»å‹éƒ½æ˜¯`E`çš„ Listã€‚`(List Nat)`ã€`(List (-> Nat Atom))`å’Œ`(List (List Atom))`éƒ½æ˜¯ List ç±»å‹ï¼Œä½†æ˜¯`(List 1)`å’Œ`(List 'ä½ å¥½)`ä¸æ˜¯åˆæ³•çš„ç±»å‹ã€‚

List æœ‰ä¸¤ä¸ª constructorï¼š`nil`å’Œ`::` [^4]ã€‚`nil`æ„é€ ä¸€ä¸ªç©º Listï¼›`::`æ¥å—ä¸¤ä¸ªå‚æ•°`e`ã€`es`ï¼Œå¦‚æœ`e`å’Œ`es`çš„ç±»å‹åˆ†åˆ«ä¸º`E`å’Œ`(List E)`ï¼Œåˆ™`(:: e es)`æ„é€ çš„æ˜¯ç±»å‹ä¸º`(List E)`æ¯”`es`å¤šä¸€ä¸ªå…ƒç´ `e`çš„ Listã€‚List ç±»å‹å¯ä»¥ç”¨å½’çº³æ³•æè¿°å¦‚ä¸‹ï¼š

```code
(List E) ::= nil
(List E) ::= (:: E (List E))
```

å¯ä»¥çœ‹å‡ºæ¥ List çš„ constructor å’Œ`Nat`çš„å¾ˆç›¸ä¼¼ï¼š`nil`å¯¹åº”äº`zero`ï¼Œ`::`å¯¹åº”äº`add1`ã€‚ä¸‹é¢æ˜¯æ„é€ ä¸€ä¸ª`(List Atom)`çš„ç¤ºä¾‹ï¼š

```pie
(claim philosophers
  (List Atom))
(define philosophers
  (:: 'Descartes
    (:: 'Hume
      (:: 'Kant nil))))
```

è¦ä½¿ç”¨æˆ–è€…å¤„ç† List ç±»å‹çš„å€¼ï¼ŒåŒæ ·ä¹Ÿéœ€è¦å¯¹åº”çš„ eliminatorã€‚List ç‰ˆçš„â€œå†…ç½®â€äº†é€’å½’çš„ eliminator å« [rec-List](https://docs.racket-lang.org/pie/index.html#%28def._%28%28lib._pie%2Fmain..rkt%29._rec-.List%29%29)ï¼Œå®ƒä¹Ÿéµå¾ªç›¸åŒçš„ä½¿ç”¨æ¨¡å¼ï¼Œå³`(rec-List target base step)`ï¼š
![rec-List](/static/images/dt/rec-List.png)
ç±»ä¼¼åœ°ï¼Œå½“`target`ä¸º`nil`æ—¶ï¼Œ`base`çš„å€¼å°±ä½œä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼›å½“`target`ä¸ä¸º`nil`è€Œå¯ä»¥å†™ä½œ`(:: e es)`æ—¶ï¼Œ`step`çš„è¿”å›å€¼åˆ™ä½œä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„æœ€ç»ˆç»“æœï¼Œæ­¤æ—¶`step`çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯`e`ã€`es`å’Œ`(rec-List es base step)`ã€‚ç»§ç»­é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯¦ç»†è¯´æ˜`rec-List`çš„ç”¨æ³•ï¼Œå†™ä¸€ä¸ªè¿”å› List é•¿åº¦çš„å‡½æ•°`length`ã€‚å¦‚æœæƒ³æŠŠ`length`å®šä¹‰æˆå¯ä»¥ä½œç”¨äºå…ƒç´ ç±»å‹ä»»æ„çš„ Listï¼ˆ`(List Nat)`ã€`(List Atom)`ç­‰ï¼‰ï¼Œè¿›è€Œå°†å…¶å£°æ˜å¦‚ä¸‹çš„è¯ï¼Œ

```pie
(claim length
  (-> (List E) ; é”™è¯¯: Not a type
    Nat))
```

è§£é‡Šå™¨ä¼šåœ¨ç¬¬äºŒè¡Œæç¤ºâ€œNot a typeâ€çš„é”™è¯¯ï¼Œå› ä¸ºåœ¨å®ƒçœ‹æ¥`E`æ²¡æœ‰è¢«å£°æ˜è¿‡æ˜¯ä¸€ä¸ªæœªçŸ¥çš„å˜é‡ï¼Œæ‰€ä»¥`(List E)`ä¹Ÿå°±ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„ç±»å‹ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°è¡¨è¾¾å¼ç”¨æ¥åœ¨ç±»å‹å£°æ˜ä¸­å¼•å…¥å˜é‡ï¼Œè¿™ä¸ªè¡¨è¾¾å¼å«ä½œ`Pi`ï¼ˆåœ¨ç¨‹åºä¸­ä¹Ÿå¯ä»¥ç”¨å¸Œè…Šå­—æ¯`Î `[^5] ä»£æ›¿ï¼‰ã€‚`length`çš„æ–°çš„ç±»å‹å£°æ˜å¦‚ä¸‹ï¼š

```pie
(claim length
  (Î  ((E U))
    (-> (List E)
      Nat)))
```

`Pi`è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªåˆ—è¡¨é‡Œå¯ä»¥å†™å¤šä¸ªç±»å‹å˜é‡`(Î  ((x X) (y Y) ...) ...)`ï¼Œå…¶ä¸­`x`ã€`y`æ˜¯å˜é‡åï¼Œ`X`å’Œ`Y`æ˜¯å˜é‡çš„ç±»å‹ã€‚`length`çš„ç±»å‹å£°æ˜é‡Œåªéœ€è¦ä¸€ä¸ªå˜é‡`E`ï¼Œå› ä¸º`E`æ˜¯ List é‡Œå…ƒç´ çš„ç±»å‹ï¼Œæ‰€ä»¥`E`çš„ç±»å‹æ˜¯`U`ã€‚å¦‚æœç±»æ¯” Java çš„æ³›å‹ï¼Œ

```java
<E> int length(List<E> lst) {...}
```

å¯èƒ½ä¼šè§‰å¾—`Pi`è¡¨è¾¾å¼ä¹Ÿåªæ˜¯å®ç°äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†å…¶å®`Pi`å¯ä»¥åšçš„æ›´å¤šã€‚å¼€å¤´ä»‹ç»çš„ç®­å¤´å‹çš„å‡½æ•°ç±»å‹åªæ˜¯`Pi`è¡¨è¾¾å¼çš„ä¸€ä¸ªç®€å†™å½¢å¼ï¼Œæ‰€ä»¥`Pi`æœ¬è´¨ä¸Šå£°æ˜çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ„å‘³ç€åˆ—è¡¨é‡Œå¯ä»¥æ”¾å…¥ä»»ä½•ç±»å‹çš„å˜é‡ã€‚æ¯”å¦‚

```pie
(claim fun1
  (-> Atom Nat
    Atom))
```

ä¹Ÿå¯ä»¥å†™æˆ

```pie
(claim fun1
  (Î  ((a Atom)
      (n Nat))
    Atom))
```

åªä¸è¿‡è¿™é‡Œå˜é‡`a`å’Œ`n`æ²¡æœ‰åœ¨åé¢çš„ç±»å‹å£°æ˜é‡Œç”¨åˆ°ï¼Œæ‰€ä»¥å†™ä½œç®­å¤´å‹çš„å°±è¶³å¤Ÿã€‚ä¸‹é¢æ˜¯ç”¨äº†`Pi`è¡¨è¾¾å¼åï¼Œå®Œæ•´çš„`length`å®šä¹‰ï¼š

```pie
(claim length
  (Î  ((E U))
    (-> (List E)
      Nat)))
(define length
  (Î» (E lst)
    (rec-List lst
      0
      (Î» (e es length-es)
        (add1 length-es)))))
```

`Î `å’Œç®­å¤´è¡¨è¾¾å¼ç»„åˆåœ¨ä¸€èµ·å£°æ˜äº†ä¸€ä¸ªæ¥å—ä¸¤ä¸ªå‚æ•°è¿”å›ä¸€ä¸ª`Nat`çš„å‡½æ•°ï¼Œå®šä¹‰ä¸­å¯¹åº”çš„ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªæ˜¯ç±»å‹ä¸º`U`çš„å‚æ•°`E`ï¼Œå¦ä¸€ä¸ªæ˜¯ç±»å‹ä¸º`(List E)`çš„å‚æ•°`lst`ã€‚å‡½æ•°ä½“ä¸­åªç”¨åˆ°äº†ç¬¬äºŒä¸ªå‚æ•°`lst`ï¼ŒæŠŠå®ƒä½œä¸º`target`ä¼ ç»™`rec-List`è¡¨è¾¾å¼ã€‚å½“`lst`ä¸º`nil`æ—¶é•¿åº¦ä¸º`0`ï¼›è‹¥`lst`å¯ä»¥è¡¨ç¤ºä¸º`(:: e es)`å½¢å¼çš„éç©º Listï¼Œåˆ™`step`å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¡¨è¾¾å¼`(rec-List es 0 step)`çš„å€¼ï¼Œå› ä¸ºè¿™ä¸ªå€¼å…¶å®å°±æ˜¯`es`çš„é•¿åº¦ï¼Œæ‰€ä»¥èµ·åå«`length-es`ã€‚åˆå› ä¸º`es`æ¯”`lst`å°‘ä¸€ä¸ªå…ƒç´ `e`ï¼Œæ‰€ä»¥`lst`é•¿åº¦ç­‰äº`es`çš„é•¿åº¦åŠ ä¸€ï¼Œå³`(add1 length-es)`ã€‚

æœ‰äº†`length`å°±å¯ä»¥å¾—åˆ°ä»»æ„ List çš„é•¿åº¦äº†ï¼š

```pie
> (length Atom philosophers)
(the Nat 3)

> (length Nat
    (:: 1 (:: 2 (:: 3 (:: 4 nil)))))
(the Nat 4)
```

ç±»ä¼¼çš„ä¹Ÿå¯ä»¥é€šè¿‡`rec-List`å®šä¹‰åˆå¹¶ List çš„å‡½æ•°`append`ï¼š

```pie
(claim append
  (Î  ((E U))
    (-> (List E)
        (List E)
      (List E))))
(define append
  (Î» (E)
    (Î» (start end)
      (rec-List start
        end
        (Î» (e es append-es)
          (:: e append-es))))))

(claim existentialists
  (List Atom))
(define existentialists
  (:: 'Kierkegaard
    (:: 'Sartre
      (:: 'Camus nil))))

> (append Atom philosophers existentialists)
(the (List Atom)
  (:: 'Descartes
    (:: 'Hume
      (:: 'Kant
        (:: 'Kierkegaard
          (:: 'Sartre
            (:: 'Camus nil)))))))
```

å‡è®¾æˆ‘ä»¬æ²¡èƒ½æ­£ç¡®åœ°å®ç°`append`ï¼Œæ¯”å¦‚é”™è¯¯åœ°å®šä¹‰äº†`step`ï¼š

```pie
(claim append-wrong
  (Î  ((E U))
    (-> (List E)
        (List E)
      (List E))))
(define append-wrong
  (Î» (E)
    (Î» (start end)
      (rec-List start
        end
        (Î» (e es append-es)
          append-es))))) ;; é”™è¯¯åœ°å¿½ç•¥äº† e
```

è§£é‡Šå™¨ä»ç„¶ä¼šæ¥å—è¿™ä¸ªå‡½æ•°å®šä¹‰ï¼Œå› ä¸ºä»ç±»å‹ç³»ç»Ÿçš„è§’åº¦æ¥çœ‹`append-wrong`ä»ç„¶æ˜¯â€œæ­£ç¡®â€çš„ï¼Œå®ƒç¡®å®è¿”å›äº†ç±»å‹æ˜¯`(List E)`çš„å€¼ï¼Œå³ä½¿è¿™ä¸ªå€¼ä¸æ˜¯æˆ‘ä»¬æ‰€é¢„æœŸçš„ï¼š

```pie
> (append-wrong Atom philosophers existentialists)
(the (List Atom)
  (:: 'Kierkegaard
    (:: 'Sartre
      (:: 'Camus nil))))
```

å¦‚æœæƒ³è®©è§£é‡Šå™¨å¸®åŠ©æˆ‘ä»¬åˆ¤æ–­ç¨‹åºæ˜¯å¦æ­£ç¡®ï¼Œåªèƒ½é€šè¿‡æŸç§å½¢å¼çš„â€œæµ‹è¯•â€æ¥å®ç°ï¼š

```pie
(check-same Nat
  (length Atom
    (append-wrong Atom philosophers existentialists))
  (+ (length Atom philosophers)
     (length Atom existentialists)))
```

è¿™é‡Œæˆ‘ä»¬é€šè¿‡`append`å‡½æ•°åº”æœ‰çš„ä¸€ä¸ªå±æ€§â€”â€” append åå¾—åˆ°çš„ List çš„é•¿åº¦ç­‰äºä¸¤ä¸ªå‚æ•° List é•¿åº¦çš„å’Œâ€”â€”æ¥æ£€éªŒå‡½æ•°çš„æ­£ç¡®æ€§ã€‚`check-same`è¡¨è¾¾å¼çš„ä½¿ç”¨æ–¹å¼æ˜¯`(check-same type expr1 expr2)`ï¼Œå¦‚æœ`expr1`å’Œ`expr2`ä¸æ˜¯ä¸¤ä¸ªç›¸ç­‰çš„`type`ç±»å‹çš„å€¼ï¼Œè§£é‡Šå™¨ä¼šâ€œé™æ€â€åœ°æŒ‡å‡ºè¿™ä¸ªé”™è¯¯ï¼š
![check-same](/static/images/dt/check-same.png)

ä¸‹é¢è¦ä»‹ç»çš„è¿™ä¸ªæ–°ç±»å‹å¯ä»¥è¯´æ˜¯æœ‰é•¿åº¦å±æ€§çš„ Listï¼Œå’Œè¿™ä¸ªæ–°ç±»å‹ç›¸å…³çš„å‡½æ•°éƒ½å¯ä»¥å€ŸåŠ©å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹æ¥è‡ªåŠ¨å®ç°ç±»ä¼¼äºä¸Šé¢ç¨‹åºç‰‡æ®µä¸­çš„å¯¹äºé•¿åº¦å±æ€§çš„æ£€æŸ¥ã€‚

### ä¾èµ–äºå€¼çš„ç±»å‹ï¼šVec

æ–‡ç« å¼€å¤´å‡æƒ³çš„é‚£ä¸ª Java çš„æœ‰é•¿åº¦å±æ€§çš„æ•°ç»„ç±»å‹å…¶å®å°±æ˜¯å¯¹ Vec ç±»å‹çš„æ¨¡ä»¿ã€‚Vec ç±»å‹å†™ä½œ`(Vec E len)`ï¼Œå…¶ä¸­`E`å’Œ List ç±»å‹ä¸­çš„ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªç±»å‹ä¸º`U`çš„å€¼ï¼Œä»£è¡¨æ‰€æœ‰å…ƒç´ çš„ç±»å‹ï¼›è€Œ`len`æ˜¯ä¸€ä¸ª`Nat`ç±»å‹çš„å€¼ï¼Œä»£è¡¨ Vec çš„é•¿åº¦ã€‚æ‰€ä»¥å¼€å¤´çš„`three-names`å¯ä»¥å£°æ˜ä¸ºï¼š

```pie
(claim three-names
  (Vec Atom 3))
```

Vec çš„ constructor å’Œ List çš„éå¸¸ç›¸ä¼¼ï¼Œåˆ†åˆ«æ˜¯`vecnil`å’Œ`vec::`ï¼Œå¯¹åº”äº List çš„`nil`å’Œ`::`ã€‚è¿™æ ·`three-names`å¯ä»¥å®šä¹‰ä¸ºï¼š

```pie
(define three-names
  (vec:: 'å¼ ä¸‰
    (vec:: 'èµµå››
      (vec:: 'æˆå‰æ€æ±— vecnill))))
```

å¦‚æœä¸å°å¿ƒå¤šå†™äº†ä¸€ä¸ª`vec::`ï¼Œåˆ™å£°æ˜çš„ç±»å‹å’Œå®é™…å®šä¹‰çš„ä¸ä¸€è‡´ï¼Œè§£é‡Šå™¨å°±ä¼šæŒ‡å‡ºè¿™ä¸ªé”™è¯¯ï¼Œè™½ç„¶é”™è¯¯æè¿°ä¸æ˜¯å¾ˆæ˜ç¡®ï¼š
![err2](/static/images/dt/err2.png)

åœ¨æ·±å…¥è®¨è®º Vec ç±»å‹å‰éœ€è¦å†ä»‹ç»å¦ä¸€ä¸ª`Nat`ç±»å‹çš„ eliminatorï¼Œå› ä¸ºå®ƒä¸ Vec ç±»å‹æœ‰ç€éå¸¸å¯†åˆ‡çš„å…³ç³»ã€‚ä»ç„¶æ˜¯é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼Œå‡è®¾å®šä¹‰ä¸€ä¸ªå‡½æ•°`repeat`ï¼Œå®ƒå¯ä»¥é‡å¤`count`æ¬¡æŸä¸ªä»»æ„ç±»å‹`E`çš„å€¼`e`ï¼Œè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º`count`ã€å…ƒç´ ç±»å‹`E`ä¸”æ‰€æœ‰å…ƒç´ éƒ½æ˜¯`e`çš„ Vecã€‚è¿™ä¸ªå‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š

```pie
(claim repeat
  (Î  ((E U)
      (count Nat))
    (-> E
      (Vec E count))))
```

å› ä¸ºç±»å‹`E`å’Œæ¬¡æ•°`count`åœ¨åé¢çš„ç±»å‹å£°æ˜ä¸­éƒ½ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥è¢«æ”¾åœ¨äº†`Î `è¡¨è¾¾å¼çš„å‚æ•°åˆ—è¡¨é‡Œã€‚è¡¨è¾¾å¼`(-> E (Vec E count))`æŒ‡çš„æ˜¯ä¸€ä¸ªæ¥å—ä¸€ä¸ªç±»å‹ä¸º`E`çš„å€¼ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ª`(Vec E count)`çš„å‡½æ•°ã€‚å‡è®¾æˆ‘ä»¬ç”¨å·²æœ‰çš„`rec-Nat`æ¥å®ç°çš„è¯ï¼Œå¤§æ¦‚ä¼šè¿™æ ·å†™ï¼š

```pie
;; ä¸€æ¬¡å¤±è´¥çš„å°è¯•ğŸ˜¢
(define repeat
  (Î» (E count)
    (Î» (e)
      (rec-Nat count
        vecnil
        (Î» (c-1 repeat-c-1)
          (vec:: e repeat-c-1))))))
```

ä½†æ˜¯é—®é¢˜æ˜¯`rec-Nat`è¦æ±‚`base`ã€`step`ä»¥åŠæ•´ä¸ª`rec-Nat`è¡¨è¾¾å¼çš„å€¼çš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œåœ¨ä¸Šè¿°å®šä¹‰ä¸­ï¼Œ`repeat`çš„å£°æ˜ç±»å‹å³æ•´ä¸ª`rec-Nat`è¡¨è¾¾å¼çš„ç±»å‹æ˜¯`(Vec E count)`ï¼›`base`æ˜¯ç±»å‹ä¸º`(Vec E 0)`çš„`vecnil`ï¼›è€Œ`step`æ¯æ¬¡é€’å½’è°ƒç”¨æ‰€è¿”å›çš„ç±»å‹éƒ½ä¸ä¸€æ ·ï¼Œåœ¨`target`ä»`1`åˆ°`count`å˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œè¿”å›å€¼ä¹Ÿä»`(Vec E 1)`å˜åˆ°`(Vec E count)`ã€‚æ‰€ä»¥è§£é‡Šå™¨ä¸ä¼šæ¥å—è¿™ä¸ªå‡½æ•°å®šä¹‰ã€‚

#### æ›´å¼ºå¤§çš„å½’çº³å¼ eliminator

åƒ Vec è¿™æ ·æ¥å—å‚æ•°çš„ç±»å‹åœ¨ç±»å‹ç†è®ºé‡Œè¢«å«åš type familyï¼Œéšç€ä¼ å…¥çš„å‚æ•°çš„ä¸åŒï¼Œå¾—åˆ°çš„ç±»å‹ä¹Ÿåœ¨å˜åŒ–ã€‚æ‰€ä»¥ä¸Šä¾‹ä¸­çš„`(Vec E 0)`ã€`(Vec E 1)`â€¦â€¦ åœ¨ç±»å‹ç³»ç»Ÿçœ‹æ¥éƒ½æ˜¯ä¸åŒçš„ç±»å‹ã€‚è€Œç±»ä¼¼äº`E`è¿™æ ·ä¸å˜çš„å‚æ•°è¢«ç§°ä½œ **parameter**ï¼Œåƒ`0`ã€`1`â€¦â€¦ è¿™æ ·å˜åŒ–ç€çš„å‚æ•°è¢«å«åš **index** [^6]ã€‚åœ¨ Pie è¯­è¨€é‡Œå¤„ç†åŒ…å«ä¸åŒ index çš„ä¸€ç±»ç±»å‹æ—¶ï¼Œéœ€è¦ç”¨åˆ°çš„ä¸€ç±» eliminator éƒ½ä»¥ ind- å¼€å¤´ï¼ˆind æ˜¯ inductive çš„ç¼©å†™ï¼‰ã€‚åœ¨`repeat`å‡½æ•°ä¸­ï¼Œå› ä¸º target æ˜¯`Nat`ç±»å‹çš„ï¼Œæ‰€ä»¥ç”¨åˆ°çš„ eliminator æ˜¯ [ind-Nat](https://docs.racket-lang.org/pie/index.html#%28def._%28%28lib._pie%2Fmain..rkt%29._ind-.Nat%29%29)ã€‚`ind-Nat`é™¤äº†æ¥å—å’Œ`rec-Nat`ç±»ä¼¼çš„`target`ã€`base`å’Œ`step`ä¸‰ä¸ªå‚æ•°å¤–ï¼Œè¿˜éœ€è¦ä¸€ä¸ªé¢å¤–çš„å‚æ•°`motive`[^7]ã€‚
![ind-Nat](/static/images/dt/ind-Nat.png)
`motive`çš„ç±»å‹æ˜¯`(-> Nat U)`ï¼Œå®ƒæ ¹æ®ä¼ å…¥çš„è‡ªç„¶æ•°å‚æ•°è¿”å›ä¸€ä¸ªå¯¹åº”çš„**ç±»å‹**ã€‚åœ¨`ind-Nat`ä¸­ï¼Œ`target`çš„ç±»å‹ä»ç„¶ä¸º`Nat`ï¼›`base`çš„ç±»å‹å˜æˆäº†`(motive zero)`ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°`motive`ä½œç”¨äºè‡ªç„¶æ•°`zero`æ—¶è¿”å›çš„ç±»å‹ï¼›æ•´ä¸ª`ind-Nat`è¡¨è¾¾å¼çš„å€¼çš„ç±»å‹æ˜¯`(motive target)`ï¼›è€Œ`step`çš„ç±»å‹è¦æ›´å¤æ‚ä¸€äº›ï¼š

```pie
(Î  ((n Nat))
  (-> (motive n)
    (motive (add1 n))))
```

å®ƒæ¥å—ä¸¤ä¸ªç±»å‹åˆ†åˆ«ä¸º`Nat`å’Œ`(motive n)`çš„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªç±»å‹ä¸º`(motive (add1 n))`çš„å€¼ã€‚`step`çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¯”å½“å‰`target`å°ä¸€çš„è‡ªç„¶æ•°`n`ï¼Œç¬¬äºŒä¸ªæ˜¯æŠŠ`n`ä½œä¸ºæ–°çš„`target`é€’å½’è°ƒç”¨`ind-Nat`â€”â€”`(ind-Nat n motive base step)`â€”â€”åå¾—åˆ°çš„å€¼ã€‚å› ä¸º`(add1 n)`ç­‰äºå½“å‰çš„`target`ï¼Œæ‰€ä»¥`step`çš„è¿”å›å€¼ç±»å‹`(motive (add1 n))`å’Œæ•´ä¸ª`ind-Nat`è¡¨è¾¾å¼å€¼çš„ç±»å‹`(motive target)`ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚ç°åœ¨å¯ä»¥ç€æ‰‹ç”¨`ind-Nat`æ¥å®ç°`repeat`å‡½æ•°äº†ã€‚é¦–å…ˆå°†`count`å‚æ•°ä½œä¸º`target`ä¼ é€’ç»™`ind-Nat`ï¼š

```pie
(claim repeat
  (Î  ((E U)
      (count Nat))
    (-> E
      (Vec E count))))
(define repeat
  (Î» (E count)
    (Î» (e)
      (ind-Nat count    ; count ä½œä¸º target
        TODO
        TODO
        TODO))))
```

æ¥ä¸‹æ¥ç¡®å®šæ¯”è¾ƒç®€å•çš„`base`çš„å€¼ï¼Œå½“`count`ä¸º`0`æ—¶ï¼Œ`repeat`åº”è¯¥è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º`0`çš„`(Vec E 0)`ï¼Œè¿™æ ·çš„ Vec åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯`vecnil`ï¼š

```pie
(define repeat
  (Î» (E count)
    (Î» (e)
      (ind-Nat count
        TODO
        vecnil          ; ç±»å‹ä¸º (Vec E 0) çš„ vecnil ä½œä¸º base
        TODO))))
```

åˆå› ä¸º`base`çš„ç±»å‹å…¶å®æ˜¯ç”±`motive`å‡½æ•°å†³å®šçš„ï¼Œå³`(motive 0)`ã€‚æ‰€ä»¥ä»`base`çš„ç±»å‹å¯ä»¥åæ¨å‡º`motive`åº”è¯¥æ˜¯ä¸€ä¸ªæ¥å—ä¸€ä¸ªè‡ªç„¶æ•°`k`ä½œä¸ºå‚æ•°ï¼Œè¿”å›ç±»å‹`(Vec E k)`çš„å‡½æ•°ã€‚è¿™é‡Œéœ€è¦æ³¨æ„`motive`**è¿”å›çš„æ˜¯ç±»å‹`(Vec E k)`ï¼Œè€Œä¸æ˜¯ç±»å‹ä¸º`(Vec E k)`çš„å€¼**ï¼Œæ¢å¥è¯è¯´`motive`è¿”å›çš„æ˜¯ç±»å‹ä¸º`U`çš„å€¼`(Vec E k)`ã€‚

```pie
(define repeat
  (Î» (E count)
    (Î» (e)
      (ind-Nat count
        (Î» (k)          ; motive å‡½æ•°
          (Vec E k))    ; è¿”å›çš„æ˜¯ç±»å‹
        vecnil
        TODO))))
```

æœ‰äº†`motive`ä¹‹åï¼Œå°±å¯ä»¥çŸ¥é“`step`çš„ç±»å‹äº†ï¼š

```pie
(Î  ((c-1 Nat))            ; c-1 ä»£è¡¨æ¯” count å°ä¸€çš„è‡ªç„¶æ•°
  (-> (Vec E c-1)         ; å³ (motive c-1)
    (Vec E (add1 c-1))))  ; å³ (motive (add1 c-1))
```

æ ¹æ®ç±»å‹å°±å¯ä»¥ç¡®å®š`step`çš„å‡½æ•°å®šä¹‰ä¸­éœ€è¦æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š

```pie
(define repeat
  (Î» (E count)
    (Î» (e)
      (ind-Nat count
        (Î» (k)
          (Vec E k))
        vecnil
        (Î» (c-1 repeat-c-1)
          TODO)))))
```

`repeat-c-1`å‚æ•°ä»£è¡¨çš„æ˜¯æŠŠ`count`å‡ä¸€åå¾—åˆ°çš„è‡ªç„¶æ•°`c-1`ä½œä¸ºæ–°çš„`target`å»é€’å½’è°ƒç”¨`ind-Nat`æ‰€å¾—åˆ°çš„ç±»å‹ä¸º`(Vec E c-1)`çš„å€¼ã€‚è¿™ä¸ªå€¼æ¯”`repeat`è¦è¿”å›çš„`(Vec E (add1 c-1))`é•¿åº¦å°‘ä¸€ï¼Œåˆå› ä¸ºè¿”å›çš„ Vec çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯`e`ï¼ˆ`repeat`çš„å‚æ•°ä¹‹ä¸€ï¼‰ï¼Œæ‰€ä»¥åªè¦æŠŠ`e`æ”¾åˆ°`repeat-c-1`é‡Œå°±å¾—åˆ°äº†æœ€ç»ˆçš„ç»“æœï¼š

```pie
(define repeat
  (Î» (E count)
    (Î» (e)
      (ind-Nat count
        (Î» (k)
          (Vec E k))
        vecnil
        (Î» (c-1 repeat-c-1)
          (vec:: e repeat-c-1))))))
```

Vec ç±»å‹ä¸­æ—¢æœ‰å…ƒç´ çš„ç±»å‹ä¿¡æ¯ï¼Œä¹ŸåŒ…å«äº†é•¿åº¦ä¿¡æ¯ï¼Œç›¸æ¯”äº List æ¥è¯´ï¼ŒVec ä½¿å¾—ç±»å‹ç³»ç»Ÿèƒ½å‘ç°æ›´å¤šçš„ç¨‹åºé”™è¯¯ã€‚å¦‚æœåœ¨ä¸Šé¢`repeat`å‡½æ•°å®šä¹‰çš„ç¬¬ 9 è¡ŒçŠ¯äº†ç±»ä¼¼å‰é¢`append-wrong`çš„é”™è¯¯ï¼Œå¿˜è®°äº†æ’å…¥`e`çš„è¯ï¼Œç±»å‹ç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªé”™è¯¯æç¤ºï¼š
![repeat-wrong](/static/images/dt/repeat-wrong.png)

æ‰€ä»¥å½“ä¸€ä¸ªå¤„ç† Vec ç±»å‹çš„å‡½æ•°é€šè¿‡äº†ç±»å‹ç³»ç»Ÿæ£€æŸ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šå¯¹å®ƒçš„æ­£ç¡®æ€§æœ‰æ›´å¤šçš„ä¿¡å¿ƒã€‚

é€šè¿‡`repeat`è¿™ä¸ªä¾‹å­ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥`ind-Nat`çš„ç”¨æ³•å’Œæ€è·¯ä¸`rec-Nat`éå¸¸æ¥è¿‘ï¼ŒåŒºåˆ«åªåœ¨äº`rec-Nat`ä¸­çš„`base`ã€`step`çš„ç¬¬äºŒä¸ªå‚æ•°ä»¥åŠ`step`çš„è¿”å›å€¼çš„ç±»å‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªç±»å‹ä¹Ÿæ˜¯æ•´ä¸ª`rec-Nat`è¡¨è¾¾å¼å€¼çš„ç±»å‹ï¼›è€Œå¯¹äº`ind-Nat`æ¥è¯´ï¼Œè¿™ä¸‰è€…çš„ç±»å‹å¯èƒ½ç›¸åŒä¹Ÿå¯èƒ½ä¸åŒï¼Œå…·ä½“æ˜¯ä»€ä¹ˆç±»å‹å–å†³äº`motive`å‡½æ•°åˆ†åˆ«ä½œç”¨äº`zero`ã€æ¯”`target`å°ä¸€çš„è‡ªç„¶æ•°ä»¥åŠ`target`æœ¬èº«æ—¶æ‰€å¾—åˆ°çš„ç±»å‹ã€‚ä»è¿™ä¸€ç‚¹ä¹Ÿå¯ä»¥çœ‹å‡º`rec-Nat`å…¶å®æ˜¯æ›´é€šç”¨çš„`ind-Nat`çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œæ‰€ä»¥å¯ä»¥ç”¨`ind-Nat`æ¥å®ç°`rec-Nat`ï¼š

```pie
(claim my-rec-Nat
  (Î  ((E U))
    (-> Nat         ; target çš„ç±»å‹
        E           ; base çš„ç±»å‹
        (-> Nat     ; step çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹
            E       ; step çš„ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹
          E)        ; step çš„è¿”å›å€¼ç±»å‹
      E)))          ; my-rec-Nat çš„è¿”å›å€¼ç±»å‹
(define my-rec-Nat
  (Î» (E)
    (Î» (target base step)
      (ind-Nat target
        (Î» (k) E)   ; è¿™é‡Œçš„ motive å†³å®šäº† baseã€step çš„å‚æ•°
        base        ; å’Œè¿”å›å€¼ç±»å‹éƒ½æ˜¯ E
        step))))
```

å½’çº³å¼ eliminator ä¹‹æ‰€ä»¥è¢«è¿™æ ·ç§°å‘¼æ˜¯å› ä¸ºå®ƒä»¬åŒ…å«äº†å’Œæ•°å­¦ä¸­å½’çº³å¼è¯æ˜ç›¸ç±»ä¼¼çš„æƒ³æ³•ã€‚å¦‚æœè¦è¯æ˜ä¸€ä¸ªå…³äºè‡ªç„¶æ•°çš„å®šç†ï¼Œé¦–å…ˆè¯æ˜ x = 0 çš„æƒ…å†µæˆç«‹ï¼Œç„¶åå‡è®¾ x = n - 1 æ—¶å®šç†æˆç«‹ï¼Œå¦‚æœå¯ä»¥ä»è¿™ä¸ªå‡è®¾æ¨å‡º x = n æ—¶å®šç†ä¹Ÿæˆç«‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥è‚¯å®šè¿™ä¸ªå®šç†åœ¨è‡ªç„¶æ•°èŒƒå›´å†…éƒ½æˆç«‹ã€‚åŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬å‘Šè¯‰`ind-Nat`å½“`target`ç­‰äº`zero`æ—¶è¡¨è¾¾å¼çš„å€¼ï¼Œä»¥åŠå½“`target`ç­‰äº`(add1 n)`æ—¶ï¼Œå¦‚ä½•ä»`n`æ‰€å¯¹åº”çš„ç»“æœå¾—åˆ°`(add1 n)`æ‰€å¯¹åº”çš„ç»“æœï¼Œé‚£ä¹ˆ`ind-Nat`å°±å¯ä»¥å¾—åˆ°æ‰€æœ‰è‡ªç„¶æ•°èŒƒå›´å†…çš„å‚æ•°æ‰€å¯¹åº”çš„è¡¨è¾¾å¼çš„å€¼ï¼Œåªä¸è¿‡é¦–å…ˆéœ€è¦é€šè¿‡`motive`å‚æ•°æŒ‡å‡ºä»»æ„ä¸€ä¸ª`Nat`æ‰€å¯¹åº”çš„ç±»å‹ã€‚Pie è¯­è¨€ä¸­æ‰€æœ‰ä»¥ ind- å¼€å¤´çš„ eliminator éƒ½åŒ…å«åŒæ ·çš„æ€æƒ³ï¼ŒåŒºåˆ«åªåœ¨äº`target`å’Œ`step`å‚æ•°çš„ç±»å‹ã€‚æ¥ä¸‹æ¥å†åˆ†åˆ«çœ‹ä¸€ä¸‹ List å’Œ Vec çš„å½’çº³å¼ eliminatorã€‚

#### List å’Œ Vec çš„å½’çº³å¼ eliminator

List ç±»å‹çš„ï¼ˆæ¯«æ— æ‚¬å¿µåœ°ï¼‰å«ä½œ [ind-List](https://docs.racket-lang.org/pie/index.html#%28def._%28%28lib._pie%2Fmain..rkt%29._ind-.List%29%29)ã€‚
![ind-List](/static/images/dt/ind-List.png)
å®ƒçš„ç”¨æ³•å’Œ`ind-Nat`éå¸¸æ¥è¿‘ï¼Œåªæ˜¯`motive`çš„å‚æ•°ç±»å‹ä»`Nat`æ¢æˆäº†`(List E)`ï¼Œ`step`çš„ä¸‰ä¸ªå‚æ•°çš„è¯­ä¹‰å’Œ`rec-List`çš„ä¹Ÿæ˜¯ç›¸åŒçš„ï¼ˆé™¤äº†ç¬¬ä¸‰ä¸ªå‚æ•°çš„ç±»å‹å˜ä¸ºç”±`motive`å†³å®šè¿™ä¸€ç‚¹ï¼‰ã€‚æœ‰äº†`ind-List`å°±å¯ä»¥å®ç°ä¸€äº›æ¥å— List ç±»å‹å‚æ•°ï¼Œè¿”å› Vec ç±»å‹å€¼çš„å‡½æ•°ï¼Œä¾‹å¦‚æŠŠ List è½¬æ¢æˆç­‰åŒçš„ Vec çš„å‡½æ•°`list->vec`ã€‚è¿™é‡Œâ€œç­‰åŒâ€æŒ‡çš„æ˜¯è½¬æ¢å‰åçš„é•¿åº¦ç›¸ç­‰ï¼Œè€Œä¸”æ‰€æœ‰å…ƒç´ ç›¸åŒã€é¡ºåºä¸å˜ã€‚å…ˆæ¥å†™å‡ºå‡½æ•°çš„å£°æ˜ï¼š

```pie
(claim list->vec
  (Î  ((E U)
      (lst (List E)))
    (Vec E (length E lst))))
```

é¦–å…ˆ`list->vec`éœ€è¦ä¸€ä¸ª`(List E)`ç±»å‹çš„å‚æ•°ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªå‚æ•°ä¹‹å‰è¦æœ‰ä¸€ä¸ªç±»å‹ä¸º`U`çš„å˜é‡`E`ï¼Œå¦å¤–è¿”å›å€¼ç±»å‹ä¸­ä¹Ÿä¼šç”¨åˆ° List ç±»å‹çš„å‚æ•°ï¼Œè¿™æ ·å°±æŠŠ`lst`å‚æ•°ä¹Ÿä½œä¸ºç±»å‹å˜é‡æ”¾åˆ°`Î `è¡¨è¾¾å¼çš„æ‹¬å·å†…ã€‚è¿”å›å€¼ç±»å‹ä¸­åŒ…å«çš„è¡¨è¾¾å¼`(length E lst)`æ˜¯ç”¨æ¥è¡¨è¾¾è½¬æ¢å‰åé•¿åº¦ç›¸åŒçš„è¯­ä¹‰ï¼Œè¿™é‡Œçš„`length`æ˜¯ä¸Šæ–‡ä¸­å®ç°çš„è®¡ç®— List é•¿åº¦çš„å‡½æ•°ã€‚ä¸‹é¢æ˜¯å‡½æ•°`list->vec`çš„å®ç°ï¼š

```pie
(define list->vec
  (Î» (E lst)
    (ind-List lst
      (Î» (xs)                   ; motive è¿”å›ä¸ List ç±»å‹çš„å‚æ•° xs
        (Vec E (length E xs)))  ; é•¿åº¦ç›¸åŒçš„ Vec ç±»å‹
      vecnil                    ; base çš„ç±»å‹ä¸º (motive nil)ï¼Œå³ (Vec E 0)ï¼Œåªèƒ½æ˜¯ vecnil
      (Î» (e es list->vec-es)    ; list->vec-es æ˜¯å‚æ•° es è¢«è½¬æ¢åçš„ç»“æœ
        (vec:: e list->vec-es)))))
```

å’Œä½¿ç”¨`ind-Nat`æ—¶è¿ç”¨çš„å½’çº³å¼æ€æƒ³ä¸€æ ·ï¼Œåœ¨ä½¿ç”¨`ind-List`çš„æ—¶å€™éœ€è¦ï¼Œ

1. é€šè¿‡`motive`å®šä¹‰å¦‚ä½•ä»`(List E)`å¾—åˆ°æ‰€éœ€çš„ç±»å‹ï¼Œè¿™é‡Œ`motive`çš„å‚æ•°`xs`å¯¹åº”ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º`E`ï¼Œé•¿åº¦ä¸`xs`ç›¸ç­‰çš„ Vecï¼›
2. é€šè¿‡`base`å‚æ•°æŒ‡å‡ºå½“`target`ç­‰äº`nil`æ—¶æ•´ä¸ª`ind-List`è¡¨è¾¾å¼çš„å€¼ï¼Œ`nil`çš„é•¿åº¦ä¸º`0`ï¼Œæ‰€ä»¥å¯¹åº”çš„ Vec å°±æ˜¯`vecnil`ï¼›
3. é€šè¿‡`step`å‡½æ•°å‘Šè¯‰è§£é‡Šå™¨ï¼Œå½“`target`ç­‰äº`(:: e es)`æ—¶å¦‚ä½•ä»`es`å¯¹åº”çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯`es`æ‰€è½¬æ¢æˆä¸ºçš„`list->vec-es`ï¼Œæ¥å¾—åˆ°`(:: e es)`æ‰€è¦è½¬æ¢æˆä¸ºçš„é‚£ä¸ª Vecï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„çŸ¥é“å°±æ˜¯`(vec:: e list->vec-es)`ã€‚

è¿™æ ·æœ€ç»ˆå¾—åˆ°çš„å°±æ˜¯ä¸€ä¸ªå¯ä»¥æŠŠä»»æ„ List è½¬æ¢æˆç­‰ä»·çš„ Vec çš„å‡½æ•°ã€‚

```pie
> (list->vec Atom philosophers)
(the (Vec Atom 3)
  (vec:: 'Descartes
    (vec:: 'Hume
      (vec:: 'Kant vecnil))))
```

åœ¨å‰é¢`repeat`çš„ä¾‹å­é‡Œå±•ç¤ºè¿‡ï¼ŒVec ç±»å‹ä½¿å¾—ç±»å‹ç³»ç»Ÿå¯ä»¥åœ¨ç¨‹åºè¿è¡Œå‰å°±æ£€æµ‹å‡ºå¯¼è‡´é•¿åº¦ä¸ä¸€è‡´çš„ä¸€ç±»é”™è¯¯ã€‚ä½†æ˜¯ä»ç„¶æœ‰å¯èƒ½å†™å‡ºé•¿åº¦å’Œç±»å‹éƒ½æ­£ç¡®è€Œå®é™…å€¼å´ä¸æ˜¯æ‰€é¢„æœŸçš„é”™è¯¯ç¨‹åºã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªåªæ˜¯é‡å¤ç¬¬ä¸€ä¸ªå…ƒç´ çš„é”™è¯¯ç‰ˆ`list->vec`ï¼š

```pie
(claim list->vec-wrong
  (Î  ((E U)
      (lst (List E)))
    (Vec E (length E lst))))
(define list->vec-wrong
  (Î» (E lst)
    (ind-List lst
      (Î» (xs)
        (Vec E (length E xs)))
      vecnil
      (Î» (e es list->vec-es)
        (repeat E (length E (:: e es)) e)))))


> (list->vec-wrong Atom philosophers)
(the (Vec Atom 3)
  (vec:: 'Descartes
    (vec:: 'Descartes
      (vec:: 'Descartes vecnil))))
```

ç±»å‹ç³»ç»Ÿæ²¡èƒ½æ£€æµ‹å‡ºè¿™ä¸ªé”™è¯¯ï¼Œç¨‹åºè¿è¡Œçš„ç»“æœä¹Ÿä¸æ˜¯é¢„æœŸçš„ã€‚é‚£ä¹ˆæ€æ ·æ‰èƒ½æ£€æµ‹å‡ºè¿™ç±»é”™è¯¯å‘¢ï¼Ÿä¸€ä¸ªå¯è¡Œçš„åŠæ³•æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡º`list->vec`çš„â€œé€†è¿ç®—â€`vec->list`ï¼Œç»§è€Œå°±å¯ä»¥è®©è¿™ä¿©ä¸ªå‡½æ•°äº’ç›¸æ£€éªŒå¯¹æ–¹çš„æ­£ç¡®æ€§ã€‚`vec->list`çš„å£°æ˜éƒ¨åˆ†å†™ä½œï¼š

```pie
(claim vec->list
  (Î  ((E U)
      (l Nat))
    (-> (Vec E l)
      (List E))))
```

ç”±äºå‚æ•°ç±»å‹ä» List å˜æˆäº† Vecï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°ä½¿ç”¨çš„æ˜¯ä»¥ Vec ä½œä¸º`target`çš„ eliminatorï¼Œ[ind-Vec](https://docs.racket-lang.org/pie/index.html#%28def._%28%28lib._pie%2Fmain..rkt%29._ind-.Vec%29%29)ã€‚
![ind-Vec](/static/images/dt/ind-Vec.png)
å› ä¸º Vec ç±»å‹å¤šäº†ä¸€ä¸ªé•¿åº¦å±æ€§ï¼Œæ‰€ä»¥ç›¸åº”çš„ï¼Œ`ind-Vec`å¢åŠ äº†ä¸€ä¸ª`Nat`ç±»å‹çš„ target-1 å¯¹åº”äº target-2 çš„é•¿åº¦ï¼Œmotive å‡½æ•°ä¹Ÿå¤šäº†ä¸€ä¸ª`Nat`ç±»å‹çš„å‚æ•°ä»£è¡¨å¦ä¸€ä¸ªå‚æ•°çš„é•¿åº¦ï¼Œæœ€å step çš„`Nat`ç±»å‹å‚æ•°`k`ä¹Ÿå¯¹åº”äº`es`å‚æ•°çš„é•¿åº¦ã€‚é™¤äº†å‚æ•°ä¸ªæ•°åŠç±»å‹çš„åŒºåˆ«ï¼Œ`ind-Vec`çš„ç”¨æ³•å’Œ`ind-List`åŸºæœ¬ä¸€è‡´ã€‚æ‰€ä»¥å‚ç…§`list->vec`åº”è¯¥å¯ä»¥å¾ˆå®¹æ˜“åœ°å¾—åˆ°`vec->list`çš„å®šä¹‰ï¼š

```pie
(claim vec->list
  (Î  ((E U)
      (l Nat))
    (-> (Vec E l)
      (List E))))
(define vec->list
  (Î» (E l)
    (Î» (vec)
      (ind-Vec l vec
        (Î» (k xs)
          (List E))
        nil
        (Î» (l-1 e es vec->list-es)
          (:: e vec->list-es))))))
```

æœ‰äº†`vec->list`ä¹‹åè¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•ç”¨ç¨‹åºè¡¨è¾¾å‡ºâ€œè¿ç»­ä¸¤æ¬¡è°ƒç”¨`list->vec`å’Œ`vec->list`ä»ç„¶å¾—åˆ°åŸå…ˆçš„ Listâ€è¿™ä¸ªæ„æ€ã€‚æˆ‘ä»¬ç°åœ¨çŸ¥é“çš„æœ€æ¥è¿‘è¿™ä¸ªéœ€æ±‚çš„å·¥å…·æ˜¯`check-same`ã€‚æ¯”å¦‚ä¸‹é¢æ£€æŸ¥çš„æ˜¯å¯¹`(List Atom)`ç±»å‹çš„`philosophers`æ¥è¿åº”ç”¨`list->vec`å’Œ`vec-list`ä¹‹åï¼Œå†…å®¹ä¸å˜ï¼š

```pie
(check-same (List Atom)
  philosophers
  (vec->list Atom 3
    (list->vec Atom  philosophers)))
```

ä¸è¿‡è¿™ä¹Ÿåªèƒ½éªŒè¯å¯¹äº`philosophers`æ¥è¯´ï¼Œ`list->vec`å’Œ`vec-list`ä¸¤ä¸ªå‡½æ•°æ˜¯æ­£ç¡®çš„ã€‚è¿™ä¸ªæµ‹è¯•å¹¶ä¸èƒ½ä¿è¯è¿™ä¸¤ä¸ªå‡½æ•°å¯¹äºä»»ä½• List æˆ– Vec éƒ½æ˜¯æ­£ç¡®çš„ã€‚è¿™å…¶å®ä¹Ÿæ˜¯å¤§å¤šæ•°è¯­è¨€ä¸­çš„å•å…ƒæµ‹è¯•æ‰€å¤„çš„çª˜å¢ƒï¼Œå®ƒä»¬åªèƒ½æ£€éªŒå‡ºæŸäº›é”™è¯¯çš„â€œå­˜åœ¨â€ä½†æ˜¯å´æ²¡åŠæ³•ä¿è¯è¿™ç±»é”™è¯¯åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½â€œä¸å­˜åœ¨â€ã€‚æœ‰çš„æµ‹è¯•å·¥å…·ä¹Ÿæä¾›äº†ä¸€äº›æ–¹æ³•æ¥åº”å¯¹è¿™ä¸ªå±€é™æ€§ï¼Œæ¯”å¦‚ [ScalaTest](http://www.scalatest.org/) æ‰€æä¾›çš„[åŸºäºå±æ€§çš„æµ‹è¯•](http://www.scalatest.org/user_guide/property_based_testing)æ–¹æ³•ï¼ŒæŒ‡çš„æ˜¯ç”¨ä¸€ä¸ªå‡½æ•°æ¥è¡¨è¾¾æµ‹è¯•å¯¹è±¡åº”è¯¥åŒ…å«çš„ç›®æ ‡å±æ€§ï¼Œç„¶åç»“åˆå†…ç½®çš„ generator æ¥æ¨¡æ‹Ÿå¯¹æµ‹è¯•å¯¹è±¡åœ¨æ•´ä¸ªä½œç”¨åŸŸå†…çš„æµ‹è¯•ã€‚ä¸‹é¢å°±æ˜¯å¯¹ä¸€ä¸ªåˆ†æ•°å®ç°ç±»`Fraction`åœ¨æ•´ä¸ªä½œç”¨åŸŸï¼ˆæ‰€æœ‰å¯èƒ½çš„è¢«é™¤æ•°ã€é™¤æ•°å¯¹ï¼‰å†…çš„ä¸€ä¸ªæµ‹è¯•ï¼š

```scala
class Fraction(n: Int, d: Int) {
  require(d != 0)
  require(d != Integer.MIN_VALUE)
  require(n != Integer.MIN_VALUE)

  val numer = if (d < 0) -1 * n else n
  val denom = d.abs

  override def toString = numer + " / " + denom
}

forAll { (n: Int, d: Int) =>
  whenever (d != 0 && d != Integer.MIN_VALUE
      && n != Integer.MIN_VALUE) {

    val f = new Fraction(n, d)

    if (n < 0 && d < 0 || n > 0 && d > 0)
      f.numer should be > 0
    else if (n != 0)
      f.numer should be < 0
    else
      f.numer should be === 0

    f.denom should be > 0
  }
}
```

ä¸è¿‡è¿™é‡Œç”¨åˆ°çš„`forAll`å¹¶ä¸æ˜¯çœŸçš„å¯¹æ‰€æœ‰å¯èƒ½çš„`n`ã€`d`ç»„åˆæ¥ç”Ÿæˆæµ‹è¯•ï¼ˆä¸ç„¶æµ‹è¯•ç¨‹åºä¼šæ— é™æœŸçš„è¿è¡Œä¸‹å»ï¼‰ï¼Œåªæ˜¯å°½å¯èƒ½å¤šå¾—ç”Ÿæˆä¸€äº›èŒƒå›´å†…æœ‰ä»£è¡¨æ€§çš„å®ä¾‹ã€‚è™½ç„¶è¿™ç±»å·¥å…·èƒ½è®©æµ‹è¯•æ›´å¯é ï¼Œä½†æ˜¯å®ƒä»¬ä»ç„¶æ²¡æœ‰å¸¦ç»™å¼€å‘è€…å¯¹ç¨‹åºæ­£ç¡®æ€§çš„ç»å¯¹ä¿¡å¿ƒã€‚æœ¬æ–‡å¼€å¤´æåˆ°è¿‡ï¼Œåƒ Pie ä¹‹ç±»çš„æ”¯æŒä¾èµ–ç±»å‹çš„è¯­è¨€æä¾›äº†ä¸€ä¸ªåœ¨é€»è¾‘ä¸Šè¯æ˜ç¨‹åºæŸäº›å±æ€§æˆç«‹ä¸å¦çš„é€”å¾„ï¼Œæœ‰äº†å®ƒæˆ‘ä»¬å¯ä»¥è®©ç¨‹åºå˜å¾—æ›´å¯é äº†ã€‚

## å®šç†è¯æ˜

ä¸ºäº†è¯´æ˜è¿™ä¸ªè¯æ˜çš„æ–¹æ³•ï¼Œéœ€è¦ä» Pie è¯­è¨€é‡Œè¡¨è¾¾ç›¸ç­‰å…³ç³»çš„ç±»å‹è¯´èµ·ã€‚åœ¨ Pie è¯­è¨€é‡Œï¼Œè¡¨ç¤º`x`ç­‰äº`y`çš„ç±»å‹å†™ä½œ`(= T x y)`ï¼Œå…¶ä¸­`T`æ˜¯`x`å’Œ`y`çš„ç±»å‹ã€‚ä¾‹å¦‚`(= Nat (+ 1 1) 2)`è¡¨ç¤ºè¡¨è¾¾å¼`(+ 1 1)`å’Œ`2`çš„å€¼ç›¸ç­‰ã€‚æ‰€ä»¥`=`ç±»å‹ä¹Ÿæ˜¯ä¸€ä¸ªä¾èµ–äºå€¼çš„ç±»å‹ã€‚

æ„é€ ä¸€ä¸ª`=`ç±»å‹çš„å€¼æ—¶ç”¨åˆ°çš„ constructor æ˜¯`same`ã€‚å¦‚æœè¡¨è¾¾å¼`e`çš„ç±»å‹æ˜¯`E`ï¼Œé‚£ä¹ˆ`(same e)`å°±æ˜¯ç±»å‹ä¸º`(= E e e)`çš„å€¼ã€‚å‰ä¾‹ä¸­çš„`(= Nat (+ 1 1) 2)`ç±»å‹çš„å€¼å¯ä»¥å†™ä½œ`(same 2)`ï¼Œå› ä¸ºè§£é‡Šå™¨å¯¹`(+ 1 1)`çš„æ±‚å€¼ç»“æœä¹Ÿæ˜¯`2`ã€‚é‚£ä¹ˆ`(= Nat 3 4)`æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„ç±»å‹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ˜¯çš„ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡åŠæ³•æ„é€ ä¸€ä¸ªè¯¥ç±»å‹çš„å€¼ï¼š

![3=4](/static/images/dt/3=4.png)

åœ¨å®šä¹‰ä¸­æ”¾å…¥`(same 4)`ä¹Ÿä¼šå¾—åˆ°ç±»ä¼¼çš„é”™è¯¯æç¤ºã€‚å¦‚æœå¥—ç”¨ä¼ ç»Ÿç¼–ç¨‹è¯­è¨€å¯¹ç±»å‹çš„å®šä½æ¥ç†è§£`=`ç±»å‹çš„è¯ï¼Œå¯èƒ½ä¼šè§‰å¾—å®ƒæœ‰äº›æ€ªå¼‚ï¼Œå› ä¸º`=`ç±»å‹å¹¶ä¸åƒå‰é¢çš„`Nat`æˆ–`Vec`ç±»å‹ï¼Œå®ƒçœ‹èµ·æ¥ä¸åƒæ˜¯ä¸€ç±»å€¼çš„é›†åˆã€‚æ‰€ä»¥ä¸å¦‚æ¢ä¸€ä¸ªè§’åº¦æ¥çœ‹å¾…`=`ç±»å‹ï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œä¸€ä¸ª**é™ˆè¿°æˆ–å‘½é¢˜**ã€‚è¿™æ ·å°±å¯ä»¥æŠŠ`(= Nat (+ 1 1) 2)`è¯»ä½œâ€œ`(+ 1 1)`å’Œ`2`æ˜¯ä¸¤ä¸ªç›¸ç­‰çš„è‡ªç„¶æ•°â€ã€‚è¿™æ—¶`=`ç±»å‹çš„**å€¼**å°±å˜æˆå®ƒæ‰€ä»£è¡¨çš„é‚£ä¸ªå‘½é¢˜çš„ä¸€ä¸ª**è¯æ˜**ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆ`(same 2)`æ˜¯`(= Nat (+ 1 1) 2)`çš„ä¸€ä¸ªè¯æ˜å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸¾è¯å‡ºäº†ä¸€ä¸ªå€¼`2`ï¼Œå®ƒæ—¢ç­‰äº`(+ 1 1)`ä¹Ÿç­‰äº`2`ã€‚åŒç†ï¼Œä¸å­˜åœ¨`(= Nat 3 4)`ç±»å‹çš„å€¼ä¹Ÿæ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æ³•æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è¯æ˜`3`ç­‰äº`4`çš„è¯æ®ã€‚åƒè¿™ç§é€šè¿‡ä¸¾è¯æ¥è¯æ˜çš„æ–¹æ³•åœ¨æ•°å­¦ä¸­è¢«å«ä½œ[æ„é€ å¼è¯æ˜ï¼ˆConstructive Proofï¼‰](https://en.wikipedia.org/wiki/Constructive_proof)[^8]ã€‚

### å…¨ç§°é‡è¯

æœ‰äº†è¿™ä¸ªçœ‹å¾…ç±»å‹çš„å…¨æ–°è§’åº¦åï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥æŠŠä»»æ„ç±»å‹éƒ½çœ‹ä½œä¸€ä¸ªå‘½é¢˜ã€‚æ¯”å¦‚`Atom`å°±æ˜¯ä¸€ä¸ªå‘½é¢˜ï¼Œè€Œä»»ä½•ä¸€ä¸ª`Atom`ç±»å‹çš„å€¼éƒ½æ˜¯å®ƒçš„è¯æ˜ï¼Œåªä¸è¿‡è¿™ä¸ªå‘½é¢˜çš„è¯æ˜å¯¹æˆ‘ä»¬æ¥è¯´æ²¡æœ‰å¤šå¤§çš„ç”¨å¤„ã€‚è€Œè®©æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯æŠŠ`Î `è¡¨è¾¾å¼ä¸`=`ç±»å‹ç»“åˆæ‰€å¾—åˆ°çš„ä¸€ç±»å‘½é¢˜ã€‚å› ä¸º`=`æ˜¯ä¾èµ–ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥æ”¾åœ¨`Î `è¡¨è¾¾å¼é‡Œï¼Œæ­¤æ—¶`Î `å¯ä»¥è¢«çœ‹ä½œæ˜¯å…¨ç§°é‡è¯ï¼Œæ•´ä¸ªè¡¨è¾¾å¼å°±å˜æˆäº†ä¸€ä¸ªå…¨ç§°å‘½é¢˜ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªå£°æ˜ï¼š

```pie
(claim 1+=add1
  (Î  ((n Nat))
    (= Nat (+ 1 n) (add1 n))))
```

å¯ä»¥æŠŠ`1+=add1`çš„ç±»å‹è¯»ä½œï¼Œâ€œå¯¹äºä»»æ„ä¸€ä¸ªè‡ªç„¶æ•°`n`ï¼Œ`(+ 1 n)`ä¸`(add1 n)`çš„å€¼æ˜¯ä¸¤ä¸ªç›¸ç­‰çš„è‡ªç„¶æ•°â€ã€‚è¿™æ ·å£°æ˜çš„å˜é‡`1+=add1`ä»£è¡¨çš„å°±æ˜¯å¯¹å‘½é¢˜çš„é™ˆè¿°ã€‚é‚£ä¹ˆè¦å¦‚ä½•è¯æ˜è¿™ç§å…¨ç§°å‘½é¢˜ï¼Ÿå…¶å®è¯æ˜çš„è¿‡ç¨‹ä¹Ÿå°±æ˜¯å®ç°ç”±`Î `è¡¨è¾¾å¼å£°æ˜çš„å‡½æ•°çš„è¿‡ç¨‹ã€‚

```pie
(define 1+=add1
  (Î» (n)
    TODO))
```

è¿™é‡Œ`TODO`ä»£è¡¨çš„æ˜¯`=`ç±»å‹çš„è¿”å›å€¼ï¼Œå› ä¸º`=`ç±»å‹çš„ constructor åªæœ‰`same`ï¼Œæ‰€ä»¥`TODO`æ˜¯ä¸€ä¸ª`same`è¡¨è¾¾å¼ï¼Œç°åœ¨çš„é—®é¢˜æ˜¯åº”è¯¥åœ¨`same`é‡Œæ”¾å…¥ä»€ä¹ˆæ ·çš„æ—¢ç­‰äº`(+ 1 n)`åˆç­‰äº`(add1 n)`çš„è¡¨è¾¾å¼ã€‚å›å¿†ä¸€ä¸‹`+`å‡½æ•°çš„å®šä¹‰ï¼š

```pie
(define +
  (Î» (n m)
    (rec-Nat n
      m
      (Î» (n-1 n-1+m)
        (add1 n-1+m)))))
```

å¯ä»¥çœ‹å‡ºæ¥`(+ 1 n)`ç»è¿‡ä¸€æ¬¡é€’å½’è°ƒç”¨`rec-Nat`åå¯ä»¥ç®€åŒ–æˆ`(add1 n)`ï¼Œæ‰€ä»¥åº”è¯¥ç”¨`(same (add1 n))`æ¥æ›¿æ¢`TODO`ã€‚å…¶å®å¦‚æœçœ‹ä¸€ä¸‹è§£é‡Šå™¨è¾“å‡ºçš„`TODO`ç±»å‹æç¤ºï¼Œå·²ç»å¯ä»¥çŸ¥é“`same`é‡Œåº”è¯¥æ”¾å…¥`(add1 n)`ï¼š

```code
c8.pie:28.4: TODO:
 n : Nat
-------------
 (= Nat
   (add1 n)
   (add1 n))
```

è¿™æ ·`1+=add1`çš„å®šä¹‰ï¼Œæˆ–è€…è¯´å¯¹`1+=add1`è¿™ä¸ªå‘½é¢˜çš„è¯æ˜æœ€åå°±æ˜¯è¿™ä¸ªæ ·å­ï¼š

```pie
(claim 1+=add1
  (Î  ((n Nat))
    (= Nat (+ 1 n) (add1 n))))
(define 1+=add1
  (Î» (n)
    (same (add1 n))))
```

è¿™ä¸ªå‘½é¢˜å£°æ˜ä¸­ï¼Œè¡¨è¾¾å¼`(+ 1 n)`é‡Œå¹¶ä¸æ˜¯ç¢°å·§æŠŠ`1`æ”¾åœ¨`n`çš„å‰é¢ï¼Œæ•…æ„è¿™ä¹ˆå†™æ˜¯ä¸ºäº†è®©å‘½é¢˜æ›´å®¹æ˜“è¯æ˜ã€‚åŸå› æ˜¯`+`å‡½æ•°çš„å®šä¹‰ä¸­æ˜¯æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºäº†`rec-Nat`çš„ targetï¼Œè¿™æ ·æŠŠ`1`æ”¾åœ¨å‰é¢å°±å¯ä»¥ä½¿`rec-Nat`è¡¨è¾¾å¼ç›´æ¥ç®€åŒ–æˆ`(add1 n)`ã€‚å¦‚æœåè¿‡æ¥æŠŠ`n`æ”¾åœ¨å‰é¢å†™æˆ`(+ n 1)`çš„è¯ï¼Œ`(rec-Nat n ...)`æ²¡åŠæ³•è¿›ä¸€æ­¥ç®€åŒ–ï¼ˆå› ä¸ºä¸çŸ¥é“æœªçŸ¥å‚æ•°`n`æ˜¯å¦ä¸ºé›¶ï¼‰ï¼Œè¿™æ ·`(same (add n))`ä¹Ÿå°±ä¸å†æ˜¯è¿™ä¸ªæ–°å‘½é¢˜çš„è¯æ˜ï¼š
![+1=add1](/static/images/dt/+1=add1.png)

é‚£ä¹ˆåº”è¯¥æ€æ ·æ¥è¯æ˜è¿™ä¸ªè°ƒæ¢äº†`1`å’Œ`n`çš„ä½ç½®åæ‰€å¾—åˆ°çš„å‘½é¢˜å‘¢ï¼Ÿå‰é¢æ›¾ç»æè¿‡å½’çº³å¼ eliminatorï¼ˆind-Natã€ind-List ç­‰ï¼‰çš„ç”¨æ³•å’Œæ•°å­¦ä¸Šçš„å½’çº³å¼è¯æ˜éå¸¸ç›¸ä¼¼ï¼Œè€Œå¯¹äºå‘½é¢˜`+1=add1`æˆ‘ä»¬å°±è¦çœŸçš„ç”¨`ind-Nat`æ¥è¿›è¡Œå½’çº³å¼è¯æ˜äº†ã€‚å¯¹äºæ‰€æœ‰çš„`ind-`eliminator çš„ä½¿ç”¨ç¬¬ä¸€æ­¥åŸºæœ¬éƒ½æ˜¯è¦å†™å‡º motive å‡½æ•°ï¼Œè¿™é‡Œå› ä¸ºæœ€ç»ˆè¦å¾—åˆ°æ˜¯`(= Nat (+ n 1) (add1 n))`ç±»å‹çš„å€¼ï¼Œå¦‚æœæŠŠ`n`ä½œä¸º`ind-Nat`çš„ target çš„è¯ï¼Œé‚£æˆ‘ä»¬éœ€è¦çš„ motive å‡½æ•°æ˜¾ç„¶å°±æ˜¯`(Î» (k) (= Nat (+ k 1) (add1 k)))`ï¼Œè¿™æ · base çš„ç±»å‹å°±æ˜¯ motive çš„å‚æ•°`k`ç­‰äº`0`æ—¶çš„è¿”å›å€¼ï¼Œ`(= Nat (+ 0 1) (add1 0))`ï¼Œç®€åŒ–å¾—åˆ°`(= Nat 1 1)`ï¼Œæ‰€ä»¥ base çš„å€¼å°±æ˜¯`(same 1)`ã€‚åŒ…å«äº† motive å’Œ base çš„å®šä¹‰å¦‚ä¸‹ï¼š

```pie
(claim +1=add1
  (Î  ((n Nat))
    (= Nat (+ n 1) (add1 n))))
(define +1=add1
  (Î» (n)
    (ind-Nat n
      (Î» (k)
        (= Nat (+ k 1) (add1 k)))
      (same 1)
      TODO)))
```

æ¥ä¸‹æ¥éœ€è¦å†™å‡º step å‡½æ•°çš„å®šä¹‰ã€‚å›å¿†ä¸€ä¸‹`ind-Nat`ä¸­ step çš„ç±»å‹æ˜¯ï¼š

```pie
(Î  ((n-1 Nat))
  (-> (motive n-1)
    (motive (add1 n-1))))
```

å…¶ä¸­çš„`n-1`æ˜¯æ¯” target å°ä¸€çš„æ•°ï¼ŒæŠŠ`motive`æ›¿æ¢æˆå†™å¥½çš„å®šä¹‰åå¾—åˆ°çš„ step çš„ç±»å‹å°±æ˜¯ï¼š

```pie
(Î  ((n-1 Nat))
  (-> (= Nat (+ n-1 1) (add1 n-1))
    (= Nat (+ (add1 n-1) 1) (add1 (add1 n-1)))))
```

å¦‚æœä»æ±‚å€¼çš„è§’åº¦æ¥çœ‹ï¼Œstep çš„ç±»å‹æ˜¯è¯´æ¥å—ä¸¤ä¸ªç±»å‹ä¸º`Nat`å’Œ`=`çš„å‚æ•°å¾—åˆ°å¦ä¸€ä¸ª`=`ç±»å‹çš„çš„å€¼ã€‚ä¸è¿‡æˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­ä»å®šç†è¯æ˜çš„è§’åº¦æ¥è§£é‡Šè¿™ä¸ªç±»å‹ï¼Œè¿™æ—¶å¯ä»¥æŠŠ`->`ç±»å‹çœ‹ä½œæ˜¯ä¸€ä¸ªâ€œå¦‚æœ...é‚£ä¹ˆ...â€çš„é™ˆè¿°å¥ã€‚è¿™æ ·æ•´ä¸ªç±»å‹å°±å¯ä»¥è¯»ä½œï¼Œâ€œå¯¹äºä»»æ„è‡ªç„¶æ•°`n-1`ï¼Œå¦‚æœ`(+ n-1 1)`ç­‰äº`(add1 n-1)`ï¼Œé‚£ä¹ˆ`(+ (add1 n-1) 1)`ä¹Ÿç­‰äº`(add1 (add1 n-1))`â€ï¼Œè¿™å…¶å®å°±æ˜¯æ•°å­¦ä¸Šçš„å½’çº³è¯æ˜ï¼Œæ‰€ä»¥å¯¹ step å‡½æ•°çš„å®ç°ä¹Ÿæ˜¯åœ¨å®Œæˆå½’çº³è¯æ˜çš„ç¬¬äºŒæ­¥ï¼šä»å‡è®¾æ¨å¯¼å‡ºè¦è¯æ˜çš„ç»“è®ºã€‚

å¦å¤–è¦è¯´çš„ä¸€ç‚¹æ˜¯è¿”å›å€¼ç±»å‹ä¸­çš„`(+ (add1 n-1) 1)`è¿™ä¸€éƒ¨åˆ†å…¶å®è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ï¼šæ ¹æ®`+`å‡½æ•°çš„å®šä¹‰å¯ä»¥æŠŠ`add1`æ‹¿åˆ°æœ€å¤–å±‚ï¼Œå˜æˆ`(add1 (+ n-1 1))`ã€‚ä¸ºäº†æ›´å®¹æ˜“å¾—å®ç° stepï¼Œæˆ‘ä»¬æŠŠå®ƒä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°æ¥å®šä¹‰ï¼ˆè¿”å›å€¼ç±»å‹å˜æˆå‰è¿°ç®€åŒ–åçš„å½¢å¼ï¼‰ï¼š

```pie
(claim step-+1=add1
  (Î  ((n-1 Nat))
    (-> (= Nat (+ n-1 1) (add1 n-1))
      (= Nat (add1 (+ n-1 1)) (add1 (add1 n-1))))))
(define step-+1=add1
  (Î» (n-1 +1=add1-n-1)
    TODO))
```

æ¥ä¸‹æ¥è¦è§£å†³çš„é—®é¢˜å°±æ˜¯ï¼Œæ€æ ·ä»ç±»å‹ä¸º`(= Nat (+ n-1 1) (add1 n-1))`çš„`+1=add1-n-1`æ¨å¯¼å‡º`(= Nat (add1 (+ n-1 1)) (add1 (add1 n-1)))`è¿™ä¸ªå‘½é¢˜ã€‚è§‚å¯Ÿä¸€ä¸‹å¯ä»¥å‘ç°è¿™ä¸¤ä¸ª`=`ç±»å‹æˆ–è€…è¯´å‘½é¢˜çš„å”¯ä¸€åŒºåˆ«æ˜¯åè¾¹ä¸¤ä¸ªç›¸ç­‰çš„è¡¨è¾¾å¼åˆ†åˆ«æ¯”å‰é¢çš„ä¸¤ä¸ªå¤šäº†ä¸€ä¸ª`add1`ã€‚æ‰€ä»¥è¿™ç›¸å½“äºåœ¨è¯æ˜å¦‚æœ`(= Nat x y)`é‚£ä¹ˆ`(= Nat (add1 x) (add1 y))`ï¼Œä»ç›´è§‰æ¥åˆ¤æ–­è¿™ä¸€å®šæ˜¯æˆç«‹çš„ï¼Œå¦‚æœä¸¤ä¸ªè‡ªç„¶æ•°ç›¸ç­‰ï¼Œé‚£ä¹ˆå„è‡ªåŠ ä¸€åä»ç„¶ç›¸ç­‰ã€‚ä½†æ˜¯è¦å¦‚ä½•åœ¨ Pie è¯­è¨€é‡Œè¡¨è¾¾è¿™æ ·çš„ç­‰ä»·å…³ç³»ï¼Ÿè¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ°çš„æ˜¯`=`ç±»å‹çš„å…¶ä¸­ä¸€ä¸ª eliminatorï¼Œ[cong](https://docs.racket-lang.org/pie/index.html#%28def._%28%28lib._pie%2Fmain..rkt%29._cong%29%29)ï¼Œå®ƒæ˜¯ congruentï¼ˆä¸€è‡´ï¼‰çš„ç¼©å†™ã€‚

`cong`æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªçš„ç±»å‹ä¸º`(= X from to)`ï¼Œå…¶ä¸­`from`å’Œ`to`çš„ç±»å‹éƒ½æ˜¯`X`ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç±»å‹ä¸º`(-> X Y)`çš„å‡½æ•°`fun`ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸ªæŠŠ`X`ç±»å‹çš„å€¼å˜ä¸º`Y`ç±»å‹çš„å‡½æ•°ï¼Œå½“ç„¶`X`å’Œ`Y`å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚`cong`çš„è¿”å›å€¼ç±»å‹æ˜¯`(= Y (fun fromt) (fun to))`ã€‚
![cong](/static/images/dt/cong.png)

ç”¨`cong`æ¥å®ç°`step-+1=add1`çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠ`(= Nat (+ n-1 1) (add1 n-1))`ç±»å‹çš„`+1=add1-n-1`ä½œä¸º targetï¼Œå†æŠŠä¸€ä¸ªç»™ä»»æ„è‡ªç„¶æ•°åŠ ä¸€çš„å‡½æ•°å½“ä½œ`cong`çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™æ ·æœ€å`cong`çš„è¿”å›å€¼å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„`(= Nat (add1 (+ n-1 1)) (add1 (add1 n-1)))`è¿™ä¸ªå‘½é¢˜çš„è¯æ˜ï¼š

```pie
(claim step-+1=add1
  (Î  ((n-1 Nat))
    (-> (= Nat (+ n-1 1) (add1 n-1))
      (= Nat (add1 (+ n-1 1)) (add1 (add1 n-1))))))
(define step-+1=add1
  (Î» (n-1 +1=add1-n-1)
    (cong +1=add1-n-1 (+ 1))))
```

è¯·æ³¨æ„è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº† Pie çš„[å‡½æ•° currying çš„ç‰¹æ€§](#æŸ¯é‡ŒåŒ–)ï¼Œ`(+ 1)`å°±æ˜¯ä¸€ä¸ªæŠŠä»»æ„è‡ªç„¶æ•°åŠ ä¸€çš„å‡½æ•°ã€‚è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†å¯¹å‘½é¢˜çš„è¯æ˜ï¼š

```pie
(claim +1=add1
  (Î  ((n Nat))
    (= Nat (+ n 1) (add1 n))))
(define +1=add1
  (Î» (n)
    (ind-Nat n
      (Î» (k)
        (= Nat (+ k 1) (add1 k)))
      (same 1)
      step-+1=add1)))
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Pie è¯­è¨€é‡Œå¯¹å‘½é¢˜çš„è¯æ˜å°±æ˜¯ä¸€ä¸ªå®ç°ç±»å‹å®šä¹‰çš„è¿‡ç¨‹ï¼Œåªè¦å†™å‡ºäº†ç±»å‹ç³»ç»Ÿå¯ä»¥æ¥å—çš„å®ç°ï¼Œä¹Ÿå°±å®Œæˆäº†å¯¹å‘½é¢˜çš„è¯æ˜ã€‚è§£é‡Šå™¨å¯¹è¯æ˜çš„è§£é‡Šæ˜¯ä¸€ä¸ªé™æ€çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å»â€œè¿è¡Œâ€å†™å¥½çš„å®šä¹‰ã€‚

æœ‰äº†è¿™äº›äº†è§£åï¼Œæˆ‘ä»¬å¯ä»¥ç€æ‰‹è§£å†³ä¸ŠèŠ‚ç»“å°¾å¤„ç•™ä¸‹æ¥çš„å…³äº`vec->list`å’Œ`list->vec`çš„æ­£ç¡®æ€§è¯æ˜äº†ã€‚è¿™ä¸ªå‘½é¢˜å¯ä»¥é™ˆè¿°ä¸ºï¼Œâ€œå¯¹äºä»»æ„ä¸€ä¸ª Listï¼Œè¿ç»­åº”ç”¨å‡½æ•°`list->vec`å’Œ`vec->list`åå¾—åˆ°çš„ç»“æœå’Œå®ƒæœ¬èº«ç›¸ç­‰â€ã€‚å’Œè¿™ä¸ªå‘½é¢˜ç­‰ä»·çš„ç±»å‹å£°æ˜æ˜¯ï¼š

```pie
(claim list->vec->list=
  (Î  ((E U)
      (lst (List E)))
    (= (List E)
       lst
       (vec->list E
         (length E lst)
         (list->vec E lst)))))
```

å‰é¢è¯æ˜`+1=add1`çš„æ—¶å€™ï¼Œå› ä¸ºæ˜¯å…³äºè‡ªç„¶æ•°çš„å®šç†ï¼Œæ‰€ä»¥ç”¨çš„æ˜¯`ind-Nat`ã€‚ç°åœ¨è¦è¯æ˜çš„æ˜¯ä¸€ä¸ªå…³äº List çš„å‘½é¢˜ï¼Œè‡ªç„¶ä¼šé€‰æ‹©`ind-List`ä½œä¸ºå…¥æ‰‹ç‚¹ã€‚å› ä¸º`lst`å‚æ•°åº”è¯¥ä½œä¸º targetï¼Œè¿™æ ·åªéœ€è¦æŠŠè¿”å›å€¼ç±»å‹ä¸­çš„`lst`éƒ½æ›¿æ¢æˆ motive å‡½æ•°çš„å‚æ•°`xs`å°±å¯ä»¥å¾—åˆ° motive çš„å®šä¹‰ï¼š

```pie
(Î» (xs)
  (= (List E)
    xs
    (vec->list E
      (length E xs)
      (list->vec E xs))))
```

ç»§è€Œå¯ä»¥çŸ¥é“ base çš„ç±»å‹ï¼Œå³`(motive nil)`çš„å€¼æ˜¯ï¼š

```pie
(= (List E)
  nil
  (vec->list E
    (length E nil)
    (list->vec E nil)))
```

è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥ç®€åŒ–æˆ`(= (List E) nil nil)`ã€‚æ‰€ä»¥åº”è¯¥ç”¨`(same nil)`ä½œä¸º base çš„å€¼ã€‚æœ‰äº† motive å’Œ base ä¹‹å`list->vec->list=`çš„å®šä¹‰å¦‚ä¸‹ï¼š

```pie
(claim list->vec->list=
  (Î  ((E U)
      (lst (List E)))
    (= (List E)
       lst
       (vec->list E
         (length E lst)
         (list->vec E lst)))))
(define list->vec->list=
  (Î» (E lst)
    (ind-List lst
      (Î» (xs)
        (= (List E)
          xs
          (vec->list E
            (length E xs)
            (list->vec E xs))))
      (same nil)
      TODO)))
```

æ¥ä¸‹æ¥éœ€è¦ç¡®å®š step å‡½æ•°çš„ç±»å‹åŠå®šä¹‰ã€‚`ind-List`çš„ step å‚æ•°ç±»å‹æ˜¯ï¼š

```pie
(Î  ((e E)
    (es (List E)))
  (-> (motive es)
    (motive (:: e es))))
```

æŠŠ`motive`æ›¿æ¢æˆæˆ‘ä»¬å†™å¥½çš„å®šä¹‰åå¾—åˆ°çš„ç±»å‹æ˜¯ï¼š

```pie
(Î  ((e E)
    (es (List E)))
  (-> (= (List E)
        es
        (vec->list E
          (length E es)
          (list->vec E es)))
    (= (List E)
      (:: e es)
      (vec->list E
        (length E (:: e es))
        (list->vec E (:: e es))))))
```

è¿™ä¸ªç±»å‹ä¹çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œç›´æ¥è¯æ˜çš„è¯å¯èƒ½ä¼šè§‰å¾—æ— ä»ä¸‹æ‰‹ã€‚æˆ‘ä»¬å¯ä»¥è¯•ç€ç®€åŒ–ä¸€ä¸‹æœ€åçš„è¿”å›å€¼ç±»å‹ã€‚æ ¹æ®`length`å‡½æ•°çš„å®šä¹‰ï¼Œå¯ä»¥çŸ¥é“`(length E (:: e es))`å…¶å®ç­‰äº`(add1 (length E es))`ï¼›åŒæ ·çš„ï¼Œ`(list->vec E (:: e es))`è¡¨è¾¾å¼ä¹Ÿå¯ä»¥ç®€åŒ–æˆ`(vec:: e (list->vec E es))`ã€‚è¿™æ ·è½¬æ¢åçš„è¿”å›å€¼ç±»å‹å°±å˜æˆäº†ï¼š

```pie
(= (List E)
  (:: e es)
  (vec->list E
    (add1 (length E es))
    (vec:: e (list->vec E es))))
```

æœ€åå†æ ¹æ®`vec->list`çš„å®šä¹‰ï¼ŒæŠŠè¿™ä¸ªç±»å‹è¿›ä¸€æ­¥ç®€åŒ–æˆï¼š

```pie
(= (List E)
  (:: e es)
  (:: e
    (vec->list E
      (length E es)
      (list->vec E es))))
```

æŠŠè¿™ä¸ªç»“æœå¸¦å› step çš„ç±»å‹ä¸­ï¼Œå°±å¾—åˆ°äº†ç®€åŒ–åçš„ step ç±»å‹ï¼š

```pie
(Î  ((e E)
    (es (List E)))
  (-> (= (List E)
        es
        (vec->list E
          (length E es)
          (list->vec E es)))
    (= (List E)
      (:: e es)
      (:: e
        (vec->list E
          (length E es)
          (list->vec E es))))))
```

ç°åœ¨ä»å‡è®¾ï¼ˆ`->`çš„å‚æ•°ï¼‰åˆ°ç»“è®ºï¼ˆ`->`çš„è¿”å›å€¼ï¼‰çš„é€”å¾„å˜å¾—æ›´æ˜æ˜¾äº†ï¼šåˆ†åˆ«æŠŠå…ƒç´ `e`åŠ åˆ°å‡è®¾ä¸­çš„`es`å’Œ`(vec-list ...)`è¡¨è¾¾å¼çš„å‰é¢ã€‚æ‰€ä»¥ä»ç„¶å¯ä»¥å€ŸåŠ©`cong`æ¥å†™å‡º step çš„å®šä¹‰ï¼š

```pie
(Î» (e es =-es)
  (cong =-es
    (Î» (xs) (:: e xs))))
```

è¿™é‡Œ`=-es`å‚æ•°ä»£è¡¨çš„æ˜¯ç±»å‹ä¸­`->`çš„å‚æ•°ï¼Œå³å¯¹äº`es`æ¥è¯´ï¼Œç­‰å¼æˆç«‹çš„å‡è®¾ï¼›`(Î» (xs) (:: e xs))`æ˜¯ä¸€ä¸ªæŠŠ`e`åŠ åˆ°ä»»æ„ List å‰é¢çš„åŒ¿åå‡½æ•°ï¼Œå®ƒä¼šè¢«ç”¨æ¥æŠŠ`e`åˆ†åˆ«åŠ åˆ°`=-es`ä¸­çš„ from å’Œ to ä¹‹å‰ã€‚ä¸è¿‡æŠŠè¿™ä¸ª step çš„å®šä¹‰æ”¾å›`list->vec->list=`çš„å®šä¹‰ä¸­åï¼Œè§£é‡Šå™¨å´æ— æ³•ç¡®å®š`(Î» (xs) (:: e xs))`çš„ç±»å‹ï¼š
![list-vec-error](/static/images/dt/list-vec-error.png)

æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨`the`è¡¨è¾¾å¼æ¥åŠ å…¥ä¸€ä¸ªç±»å‹æç¤ºï¼š

```pie
(Î» (e es =-es)
  (cong =-es
    (the (-> (List E) (List E))
      (Î» (xs) (:: e xs)))))
```

è¿™æ ·æˆ‘ä»¬å°±å†™å‡ºäº†å®Œæ•´çš„å¯¹äº`list->vec->list=`å‘½é¢˜çš„è¯æ˜ï¼š

```pie
(claim list->vec->list=
  (Î  ((E U)
      (es (List E)))
    (= (List E)
       es
       (vec->list E
         (length E es)
         (list->vec E es)))))
(define list->vec->list=
  (Î» (E lst)
    (ind-List lst
      (Î» (xs)
        (= (List E)
          xs
          (vec->list E
            (length E xs)
            (list->vec E xs))))
      (same nil)
      (Î» (e es =-es)
        (cong =-es
          (the (-> (List E) (List E))
            (Î» (xs) (:: e xs))))))))
```

å› ä¸ºç±»å‹ç³»ç»Ÿæ¥å—äº†è¿™ä¸ªå®šä¹‰ï¼Œä¹Ÿå°±æ„å‘³ç€â€œå¯¹äºä»»æ„ä¸€ä¸ª Listï¼Œè¿ç»­åº”ç”¨`list->vec`å’Œ`vec->list`åå€¼ä¸å˜â€è¿™ä¸ªå®šç†æ˜¯æˆç«‹çš„ã€‚è¿™æ ·æˆ‘ä»¬ä¹Ÿå°±åŸºæœ¬èƒ½å¤Ÿç¡®å®šå‡½æ•°`list->vec`å’Œ`vec->list`çš„å®šä¹‰æ˜¯æ­£ç¡®çš„ã€‚ä¸ºäº†è¿›ä¸€æ­¥è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ç€æŠŠ`list->vec->list=`çš„å£°æ˜å’Œå®šä¹‰Â·ä¸­çš„`list->vec`æ¢æˆä¸ŠèŠ‚é‡Œçš„`list->vec-wrong`ï¼Œçœ‹çœ‹è§£é‡Šå™¨ä¼šç»™å‡ºä»€ä¹ˆæ ·çš„å›åº”ï¼š
![list-vec-wrong](/static/images/dt/list-vec-wrong.png)

ç±»å‹ç³»ç»Ÿä¸å†æ¥å—è¿™ä¸ªè¯æ˜äº†ï¼Œè™½ç„¶é”™è¯¯æ¶ˆæ¯æ¯”è¾ƒæŠ½è±¡ï¼Œä½†è‡³å°‘èƒ½çœ‹å‡ºæ¥å¦‚æœå‡½æ•°å®šä¹‰é”™è¯¯çš„è¯ï¼Œç±»å‹ç³»ç»Ÿå°±ä¼šæ‹’ç»æˆ‘ä»¬å¯¹å®šç†çš„è¯æ˜ã€‚

### å­˜åœ¨é‡è¯

ä¸ŠèŠ‚è¯´äº†å¦‚æœæŠŠç±»å‹çœ‹ä½œå®šç†çš„è¯ï¼Œ`Î `å°±ç›¸å½“äºå…¨ç§°é‡è¯ã€‚é‚£ä¹ˆè°“è¯é€»è¾‘ä¸­çš„å­˜åœ¨é‡è¯åœ¨ Pie çš„ç±»å‹ä¸­æ˜¯å¦‚ä½•è¡¨è¾¾çš„å‘¢ã€‚å…ˆä»‹ç»ä¸€ä¸ªæ–°çš„ç±»å‹`Pair`ã€‚ä»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸€ä¸ª`Pair`ç±»å‹çš„å€¼ç”±ä¸¤ä¸ªå€¼ç»„æˆï¼Œè¿™ä¸¤ä¸ªå€¼çš„ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚`Pair`ç±»å‹å¯ä»¥å†™ä½œ`(Pair A D)`ï¼Œå…¶ä¸­`A`æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç±»å‹ï¼Œ`D`åˆ™æ˜¯ç¬¬äºŒä¸ªçš„ç±»å‹ã€‚æ„é€ ä¸€ä¸ª`Pair`ç”¨åˆ°çš„ constructor æ˜¯`cons`:

```pie
(claim a-pair
  (Pair Nat Atom))
(define a-pair
  (cons 5 'men))
```

å¦å¤–`Pair`æœ‰ä¸¤ä¸ª eliminatorï¼Œ`car`å’Œ`cdr`ï¼Œå¯ä»¥åˆ†åˆ«ç”¨æ¥å¾—åˆ°ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå…ƒç´ ï¼š

```pie
> a-pair
(the (Pair Nat Atom)
  (cons 5 'men))

> (car a-pair)
(the Nat 5)

> (cdr a-pair)
(the Atom 'men)
```

å°±åƒ`Î `è¡¨è¾¾å¼æ˜¯`->`ç±»å‹çš„ä¸€ä¸ªæ›´ä¸€èˆ¬çš„è¡¨ç°å½¢å¼ä¸€æ ·ï¼Œ`Pair`ä¹Ÿæœ‰ä¸€ä¸ªæ›´é€šç”¨çš„ç±»å‹è¡¨è¾¾å¼`Sigma`ï¼Œä¹Ÿå¯ä»¥ç®€å†™æˆå¸Œè…Šå­—æ¯`Î£`[^9]ã€‚`Î£`ç±»å‹è¡¨è¾¾å¼çš„ç”¨æ³•æ˜¯`(Î£ ((x A1) (y A2) ...) D)`ï¼Œå…¶ä¸­`x`å’Œ`y`æ˜¯ä¸¤ä¸ªå˜é‡ï¼Œå¯ä»¥å‡ºç°åœ¨ç±»å‹`D`ä¸­ã€‚å½“`Î£`å’Œ`=`ç±»å‹ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠ`Î£`çœ‹ä½œæ˜¯å­˜åœ¨é‡è¯ã€‚ä¾‹å¦‚è¿™ä¸ªç±»å‹ï¼š

```pie
(Î£ ((name Atom))
  (= Atom name 'Jack))
```

å¯ä»¥æŠŠå®ƒè¯»ä½œï¼Œâ€œå­˜åœ¨ä¸€ä¸ª`Atom`ç±»å‹çš„å€¼`name`ï¼Œå®ƒçš„å€¼ç­‰äº`'Jack`â€ã€‚è¿™ä¸ªå‘½é¢˜çš„è¯æ˜ä¹Ÿå¾ˆç®€å•ï¼Œå’Œ`'Jack`ç›¸ç­‰çš„`Atom`å€¼ä¹Ÿåªæœ‰`'Jack`ï¼š

```pie
(cons 'Jack (same 'Jack))
```

é‡Œé¢çš„`same`æ˜¯ç”¨æ¥æ„é€ `=`ç±»å‹çš„å€¼ï¼Œ`cons`æ˜¯ç”¨æ¥æ„é€ `Î£`è¡¨è¾¾å¼æ‰€å£°æ˜çš„`Pair`ç±»å‹çš„å€¼ï¼Œè¿™ä¸ªå€¼ä¹Ÿæ˜¯è¿™ä¸ªå­˜åœ¨å‘½é¢˜çš„è¯æ˜ã€‚

æœ‰äº†å­˜åœ¨é‡è¯`Î£`ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è¡¨è¾¾æ›´å¤šæœ‰æ„æ€çš„å‘½é¢˜äº†ï¼Œæ¯”å¦‚å¯ä»¥ç”¨å®šç†æ¥è¡¨ç¤ºæŸä¸ªè‡ªç„¶æ•°æ˜¯å¦æ˜¯å¶æ•°ã€‚å›æƒ³ä¸€ä¸‹æ•°å­¦ä¹¦ä¸Šå¯¹å¶æ•°çš„å®šä¹‰ï¼šèƒ½è¢« 2 æ•´é™¤çš„æ•°å«åšå¶æ•°ã€‚å¦‚æœç›´æ¥å¥—ç”¨è¿™ä¸ªå®šä¹‰çš„è¯æˆ‘ä»¬é¦–å…ˆéœ€è¦å®ç°ä¸€ä¸ªé’ˆå¯¹è‡ªç„¶æ•°çš„é™¤æ³•å‡½æ•°ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥æ¢ä¸ªæ€è·¯ï¼Œèƒ½è¢« 2 æ•´é™¤ä¹Ÿæ„å‘³ç€è¿™ä¸ªè‡ªç„¶æ•°ç­‰äºå¦ä¸€ä¸ªæ•°ä¸ 2 çš„ä¹˜ç§¯ï¼Œå¦‚æœæŠŠä¹˜æ³•æ¢æˆåŠ æ³•çš„è¯ï¼Œå°±æ˜¯å¦ä¸€ä¸ªæ•°ä¸è‡ªèº«çš„å’Œã€‚æ‰€ä»¥è¿™ä¸ªå¶æ•°å‘½é¢˜å¯ä»¥è¡¨è¾¾ä¸ºï¼Œâ€œå¦‚æœè‡ªç„¶æ•° n æ˜¯å¶æ•°ï¼Œé‚£ä¹ˆå­˜åœ¨å¦ä¸€ä¸ªæ•° m ä½¿å¾— n ç­‰äº m + mâ€ã€‚è¿™æ ·â€œ0 æ˜¯å¶æ•°â€å°±å¯ä»¥ç”¨ç±»å‹å†™æˆï¼š

```pie
(Î£ ((m Nat))
  (= Nat 0 (+ m m)))
```

æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æŠŠç±»å‹ä¸­çš„`0`æŠ½è±¡æˆä¸€ä¸ªå‡½æ•°å‚æ•°ï¼Œæ¥å¾—åˆ°ä¸€ä¸ªç”Ÿæˆâ€œæŸä¸ªè‡ªç„¶æ•°æ˜¯å¶æ•°â€è¿™ä¸ªå®šç†çš„å‡½æ•°ï¼š

```pie
(claim Even
  (-> Nat U))
(define Even
  (Î» (n)
    (Î£ ((half Nat))
      (= Nat n (+ half half)))))
```

å› ä¸º`Even`æ¥å—ä¸€ä¸ªè‡ªç„¶æ•°ç±»å‹çš„å‚æ•°`n`ï¼Œè¿”å›ä¸€ä¸ªå…³äº`n`çš„å®šç†ï¼ˆ`n`æ˜¯å¶æ•°ï¼‰ï¼Œè€Œå®šç†å³ç±»å‹ï¼Œæ‰€ä»¥`Even`ä¹Ÿæ˜¯ä¸€ä¸ªç”Ÿæˆç±»å‹çš„å‡½æ•°ï¼Œè¿™å°±éœ€è¦åœ¨å£°æ˜ä¸­æŠŠè¿”å›å€¼ç±»å‹å†™ä½œ`U`ï¼Œè€Œåœ¨å‡½æ•°å®šä¹‰ä¸­æ‰è¿”å›ä¸€ä¸ª`Î£`è¡¨è¾¾å¼ã€‚ç°åœ¨å°±å¯ä»¥æŠŠâ€œ0 æ˜¯å¶æ•°â€è¿™ä¸ªå‘½é¢˜å£°æ˜ä¸ºï¼š

```pie
(claim zero-is-even
  (Even 0))
```

è¯æ˜`zero-is-even`è¿™ä¸ªå‘½é¢˜å°±æ˜¯å»æ„é€ ä¸€ä¸ª`(Î£ ((half Nat)) (= Nat 0 (+ half half)))`ç±»å‹çš„å€¼ã€‚å› ä¸º`0`çš„ä¸€åŠè¿˜æ˜¯`0`ï¼Œæ‰€ä»¥å®ƒçš„è¯æ˜æ˜¯ï¼š

```pie
(claim zero-is-even
  (Even 0))
(define zero-is-even
  (cons 0 (same 0)))
```

åŒç†ï¼Œâ€œ10 æ˜¯å¶æ•°â€è¿™ä¸ªå‘½é¢˜çš„è¯æ˜å¯ä»¥å†™ä½œï¼š

```pie
(claim ten-is-even
  (Even 10))
(define ten-is-even
  (cons 5 (same 10)))
```

æˆ‘ä»¬è¿˜çŸ¥é“æŠŠä»»æ„ä¸€ä¸ªå¶æ•°åŠ  2 å¾—åˆ°çš„ä»ç„¶æ˜¯å¶æ•°ï¼Œé‚£ä¹ˆå¦‚ä½•è¯æ˜è¿™ä¸ªå®šç†å‘¢ï¼Ÿå…ˆå†™å‡ºå®ƒçš„ç±»å‹å£°æ˜ï¼š

```pie
(claim +two-even
  (Î  ((n Nat))
    (-> (Even n)
      (Even (+ 2 n)))))
```

è¦è¯æ˜è¿™ä¸ªå‘½é¢˜ï¼Œå°±å¾—æƒ³åŠæ³•ä»`(Even n)`ç±»å‹ä¹Ÿå°±æ˜¯`(Î£ ((half Nat)) (= Nat n (+ half half)))`ç±»å‹çš„å€¼å¾—åˆ°`(Even (+ 2 n))`ç±»å‹å³`(Î£ ((new-half Nat)) (= Nat (+ 2 n) (+ new-half new-half)))`ç±»å‹çš„å€¼ã€‚è¿™ä¸¤ä¸ªç±»å‹é‡Œçš„`half`å’Œ`new-half`æ˜¯æœ‰ä¸€å®šå…³è”æ€§çš„ï¼Œæƒ³ä¸€ä¸‹ä¼šå‘ç°`new-half`å…¶å®ç­‰äº`(add1 half)`ï¼Œå› ä¸ºå¶æ•°åŠ  2 åçš„ä¸€åŠæ¯”åŸæ¥çš„ä¸€åŠå¤§ä¸€ã€‚æ‰€ä»¥è¿”å›å€¼çš„`cdr`éƒ¨åˆ†çš„ç­‰å¼å¯ä»¥è¿›ä¸€æ­¥å†™æˆ`(= Nat (+ 2 n) (+ (add1 half) (add1 half)))`ã€‚ä¸‹é¢æ˜¯è¯æ˜çš„å¼€å¤´éƒ¨åˆ†ï¼š

```pie
(define +two-even
  (Î» (n)
    (Î» (even-n)                 ; (Î£ ((half Nat)) (= Nat n (+ half half)))
      (cons (add1 (car even-n)) ; (car even-n) å°±æ˜¯ (Even n) ä¸­çš„ half
        TODO))))                ; (= Nat (+ 2 n) (+ (add1 half) (add1 half)))
```

å¦‚æœå¯¹æ¯”ä¸€ä¸‹`(cdr even-n)`çš„ç±»å‹`(= Nat n (+ half half))`å’Œ`TODO`çš„ç±»å‹`(= Nat (+ 2 n) (+ (add1 half) (add1 half))`ï¼Œä¼šå‘ç°å…¶å®åè€…å…¶å®å°±æ˜¯æŠŠå‰è€…çš„ä¸¤ä¸ªåŠ æ•°åˆ†åˆ«åŠ  2 åå¾—åˆ°çš„ï¼ˆä¸¤ä¸ª`(add1 half)`ç›¸åŠ ç›¸å½“äºæŠŠ`(+ half half)`æ•´ä¸ªåŠ  2ï¼‰ã€‚è¿™æ ·çœ‹èµ·æˆ‘ä»¬å¯ä»¥ç”¨`cong`ä»`(cdr even-n)`æ¥å¾—åˆ°æœŸæœ›çš„ç±»å‹çš„å€¼ï¼š

```pie
(define +two-even
  (Î» (n)
    (Î» (even-n)
      (cons (add1 (car even-n))
        (cong (cdr even-n) (+ 2)))))) ; é”™è¯¯ï¼šç±»å‹ä¸åŒ¹é…
```

ä½†æ˜¯å®é™…è¿è¡Œçš„ç»“æœæ˜¯è§£é‡Šå™¨åœ¨æœ€åä¸€è¡ŒæŠ¥å‡ºç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ï¼š
![plus2even](/static/images/dt/plus2even.png)
æˆ‘ä»¬ç”¨`cong`åšçš„å°è¯•è¿˜æ˜¯å¤±è´¥äº†ï¼Œä¸Šé¢çš„ Expected æŒ‡çš„æ˜¯å£°æ˜çš„ç±»å‹`(= Nat (+ 2 n) (+ (add1 half) (add1 half))`ï¼Œä¸‹é¢çš„ but given åˆ™æ˜¯è¡¨è¾¾å¼`(cong (cdr even-n) (+ 2))`çš„ç±»å‹ã€‚ä»”ç»†å¯¹æ¯”ä¸Šä¸‹ä¸¤ä¸ªç±»å‹ä¼šå‘ç°é—®é¢˜å‡ºåœ¨`(+ (add1 half) (add1 half))`åªèƒ½æŠŠç¬¬ä¸€ä¸ª`add1`æåˆ°æœ€å¤–å±‚ï¼Œä½†æ˜¯å¯¹åä¸€ä¸ªå´æ— èƒ½ä¸ºåŠ›ã€‚åƒæˆ‘ä»¬ä¹‹å‰è¯´çš„ï¼Œæ ¹æºè¿˜æ˜¯åœ¨`+`å‡½æ•°çš„å®šä¹‰ä¸­æ˜¯æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºäº† targetã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å…ˆè¯•ç€å£°æ˜â€œ`+`çš„ç¬¬äºŒä¸ªå‚æ•°çš„`add1`ä¹Ÿæ˜¯å¯ä»¥æåˆ°æœ€å¤–å±‚çš„â€è¿™ä¸ªä¸­é—´å®šç†ã€‚è¿™ä¸ªä¸­é—´å‘½é¢˜çš„è¯æ˜å¯ä»¥è¢«ç”¨æ¥æŠŠä¸Šå›¾ä¸­ä¸åŒ¹é…çš„ä¸¤ä¸ªç±»å‹ä¸²åˆ°ä¸€èµ·ã€‚ä¸‹é¢å°±æ˜¯è¿™ä¸ªä¸­é—´å®šç†çš„å£°æ˜ï¼š

```pie
(claim lift-right-add1
  (Î  ((n Nat)
      (m Nat))
    (= Nat (add1 (+ n m)) (+ n (add1 m)))))
```

è¿™é‡Œ`=`ç±»å‹çš„ from éƒ¨åˆ†çš„`add1`åœ¨`+`çš„å¤–é¢ï¼Œto éƒ¨åˆ†çš„`add1`åˆ™åœ¨ç¬¬äºŒä¸ªåŠ æ•°çš„å‰é¢ï¼Œå¦‚æœ from å’Œ to ç›¸ç­‰ä¹Ÿå°±æ„å‘³ç€ç¬¬äºŒä¸ªåŠ æ•°å‰çš„`add1`æ˜¯å¯ä»¥æåˆ°`+`å‡½æ•°å¤–å±‚çš„ã€‚è¿™æ˜¯ä¸ªå…³äºè‡ªç„¶æ•°çš„å‘½é¢˜ï¼Œå¯ä»¥ç”¨`ind-Nat`æ¥è¯æ˜ï¼š

```pie
(define lift-right-add1
  (Î» (n m)
    (ind-Nat n
      (Î» (k)
        (= Nat (add1 (+ k m)) (+ k (add1 m))))
      (same (add1 m))
      (Î» (n-1 lra-n-1)  ; (= Nat (add1 (+ n-1 m)) (+ n-1 (add1 m)))
        TODO))))        ; (= Nat (add1 (+ (add1 n-1) m)) (+ (add1 n-1) (add1 m)))
```

è¿™é‡Œä¸ºäº†è®©è¯æ˜æ›´ç®€å•ï¼Œé€‰æ‹©æŠŠç¬¬ä¸€ä¸ªå‚æ•°`n`ä½œä¸º targetã€‚æ³¨é‡Šä¸­åˆ†åˆ«å†™å‡ºäº†`lra-n-1`å’Œ`TODO`çš„ç±»å‹ï¼Œ`TODO`çš„ç±»å‹å¯ä»¥é€šè¿‡æŠŠä¸¤ä¸ª`n-1`å‰é¢çš„`add1`éƒ½æåˆ°æœ€å¤–å±‚è¿›ä¸€æ­¥ç®€åŒ–æˆ`(= Nat (add1 (add1 (+ n-1 m))) (add1 (+ n-1 (add1 m))))`ï¼Œè¿™æ ·æˆ‘ä»¬å°±åˆå¯ä»¥ç”¨`cong`æ¥è¯æ˜äº†ï¼š

```pie
(define lift-right-add1
  (Î» (n m)
    (ind-Nat n
      (Î» (k)
        (= Nat (add1 (+ k m)) (+ k (add1 m))))
      (same (add1 m))
      (Î» (n-1 lra-n-1)            ; (= Nat (add1 (+ n-1 m)) (+ n-1 (add1 m)))
        (cong lra-n-1 (+ 1))))))  ; (= Nat (add1 (add1 (+ n-1 m))) (add1 (+ n-1 (add1 m))))
```

æœ‰äº†`lift-right-add1`ï¼Œå‰©ä¸‹çš„é—®é¢˜å°±æ˜¯æ€æ ·ç”¨å®ƒæ¥è§£å†³`+two-even`ä¸­ç±»å‹ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå†å›é¡¾æ€»ç»“ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å£°æ˜çš„ç±»å‹ï¼ˆä¹Ÿå°±æ˜¯è¦è¯æ˜çš„å‘½é¢˜ï¼‰æ˜¯`(= Nat (+ 2 n) (+ (add1 half) (add1 half)))`ï¼Œç°åœ¨å·²ç»ä»å·²æœ‰çš„`(Even n)`ç±»å‹çš„å€¼`even-n`é€šè¿‡`cong`å¾—åˆ°äº†ä¸€ä¸ªç±»å‹æ˜¯`(= Nat (+ 2 n) (add1 (add1 (+ half half))))`çš„å€¼`(cong (cdr even-n) (+ 2))`ã€‚è¿™ä¸¤ä¸ªç±»å‹ä¸åŒ¹é…çš„åŸå› æ˜¯`(+ (add1 half) (add1 half))`çš„ç¬¬äºŒä¸ª`add1`æ²¡æ³•æåˆ°`+`çš„å¤–å±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆè¯æ˜äº†å¯ä»¥æŠŠç¬¬äºŒä¸ª`add1`æå‡ºæ¥çš„ä¸­é—´å®šç†`lift-right-add1`ï¼Œç°åœ¨çš„é—®é¢˜å°±æ˜¯æ€æ ·ç”¨è¿™ä¸ªä¸­é—´å®šç†æŠŠæˆ‘ä»¬å·²æœ‰çš„ç±»å‹è½¬æˆè¦å¾—åˆ°çš„ç±»å‹ã€‚è¿™å°±è¦ç”¨åˆ°`=`ç±»å‹çš„å¦ä¸€ä¸ªå«ä½œ`replace`çš„ eliminator äº†ï¼š
![replace](/static/images/dt/replace.png)
ç›´æ¥ä»`replace`çš„è¿™ä¸ªç±»å‹æè¿°ä¸Šçœ‹å®ƒçš„ç”¨æ³•ä¸æ˜¯å¾ˆç›´è§‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»“åˆ`+two-even`ä¸­è¦è§£å†³çš„é—®é¢˜æ¥è¯´æ˜ä¸€ä¸‹ï¼š
![+two-even](/static/images/dt/+two-even.png)
ä¸Šå›¾ä¸­ï¼Œç®­å¤´ 1 æŒ‡å‘çš„æ˜¯ä¸­é—´å®šç†`lift-right-add1`ï¼Œæˆ‘ä»¬æŠŠå®ƒä½œä¸º`replace`çš„ targetã€‚ç®­å¤´ 2 æŒ‡å‘çš„æ˜¯`replace`çš„ motiveï¼Œé‡Œé¢çš„ç©ºç™½æ–¹æ¡†ä»£è¡¨çš„æ˜¯`motive`çš„å‚æ•°ã€‚target çš„çº¢è“ä¸¤éƒ¨åˆ†å¯¹åº”çš„åˆ†åˆ«æ˜¯`=`è¡¨è¾¾å¼çš„ from å’Œ toã€‚å½“æŠŠçº¢è‰²çš„ from ä½œä¸ºå‚æ•°ä¼ ç»™ motive æ—¶ï¼Œå¾—åˆ°æ˜¯æˆ‘ä»¬å·²æœ‰çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ç®­å¤´ 3 æŒ‡å‘çš„çº¢è‰²è¡¨è¾¾å¼ï¼Œè€Œè¿™ä¸ªç±»å‹çš„è¯æ˜æ­£æ˜¯æˆ‘ä»¬ç”¨`cong`æ‰€å¾—åˆ°çš„å€¼`(cong (cdr even-n) (+ 2))`ã€‚è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯å› ä¸º`lift-right-add1`æ˜¯ä½œç”¨äºä»»æ„è‡ªç„¶æ•°`n`å’Œ`m`çš„å®šç†ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æŠŠ`n`å’Œ`m`åˆ†åˆ«æ¢æˆ`(add half)`å’Œ`half`ã€‚

æœ€åå½“æŠŠè“è‰²çš„éƒ¨åˆ†ä¼ é€’ç»™ motive åï¼Œå¾—åˆ°çš„å°±æ˜¯æˆ‘ä»¬è¦è¯æ˜çš„å‘½é¢˜ï¼ˆç®­å¤´ 4 æ‰€æŒ‡ï¼‰ï¼Œè€Œ`replace`è¡¨è¾¾å¼çš„è¿”å›å€¼å°±æ˜¯è¿™ä¸ªå‘½é¢˜çš„è¯æ˜ã€‚ä»é€»è¾‘ä¸Šæ¥ç†è§£`replace`å¯èƒ½ä¼šæ›´å®¹æ˜“ä¸€äº›ï¼Œå®ƒè¡¨è¾¾çš„æƒ³æ³•å…¶å®å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªç­‰ä»·çš„å‘½é¢˜ï¼Œtarget çš„ from å’Œ toï¼Œå¦‚æœèƒ½ç»™å‡º from -> Uï¼ˆ`(motive from)`ï¼‰è¿™ä¸ªå‘½é¢˜çš„è¯æ˜ï¼ˆ`replace`çš„ baseï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ° to -> Uï¼ˆ`(motive to)`ï¼‰è¿™ä¸ªå‘½é¢˜çš„è¯æ˜ã€‚ç°åœ¨æˆ‘ä»¬æœ‰äº†`+two-even`çš„è¯æ˜çš„æœ€åä¸€å—æ‹¼å›¾äº†ï¼š

```pie
(claim +two-even
  (Î  ((n Nat))
    (-> (Even n)
      (Even (+ 2 n)))))
(define +two-even
  (Î» (n)
    (Î» (even-n) ; (Î£ ((half Nat)) (= Nat n (+ half half)))
      (cons (add1 (car even-n))
        (replace (lift-right-add1
                   (add1 (car even-n))
                   (car even-n))
          (Î» (k)
            (= Nat (+ 2 n) k))
          (cong (cdr even-n) (+ 2)))))))
```

è¿™æ®µç¨‹åºé‡Œçš„`(car even-n)`æ˜¯`(Even n)`ç±»å‹ä¸­çš„`half`ï¼Œ`(cdr even-n)`æ˜¯`(Even n)`ä¸­çš„ç­‰å¼ã€‚è€Œ`(lift-right-add1 (add1 (car even-n)) (car even-n))`å…¶å®å°±æ˜¯æŠŠä¸­é—´å®šç†`lift-right-add1`é‡Œçš„`n`å’Œ`m`åˆ†åˆ«æ¢æˆ`(add1 (car even-n))`å’Œ`(car even-n)`ã€‚

è´¹å°½è¾›è‹¦ç»ˆäºå¾—åˆ°äº†å‘½é¢˜`+two-even`çš„è¯æ˜ï¼Œä¸è¿‡è¿™ä»½â€œè¾›è‹¦â€ä¹Ÿè®¸å¹¶ä¸æ˜¯å¾ˆå¿…è¦ ğŸ˜…ã€‚ åƒå‰é¢æåˆ°çš„ï¼Œè¿™ä¸ªè¯æ˜çš„å›°éš¾æ ¹æºäº`+`å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å¦‚æœæ˜¯`(add1 ...)`çš„å½¢å¼ï¼Œè¿™ä¸ª`add1`æ˜¯æ²¡æ³•æ‹¿åˆ°`+`å¤–é¢çš„ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼å®šä¹‰`Even`ï¼Œä½¿å¾—`+`ä¸å†å‡ºç°ï¼Œæ˜¯ä¸æ˜¯`+two-even`ä¹Ÿä¼šå˜å¾—æ›´åŠ å®¹æ˜“è¯æ˜å‘¢ï¼Ÿæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°`double`ï¼š

```pie
(claim double
  (-> Nat Nat))
(define double
  (Î» (n)
    (rec-Nat n
      0
      (Î» (n-1 double-n-1)
        (+ 2 double-n-1)))))
```

è¿™ä¸ªå®šä¹‰é€’å½’åœ°éå†å‚æ•°`n`ä¸­çš„æ¯ä¸ª`add1`ï¼Œç„¶åå°†å…¶æ›¿æ¢æˆä¸¤ä¸ª`add1`ï¼Œæ‰€ä»¥æœ€ç»ˆç»“æœå°±æ˜¯ä¸€ä¸ªäºŒå€äºå‚æ•°`n`çš„è‡ªç„¶æ•°ã€‚æ¥ä¸‹æ¥ç”¨`double`æ¥å®šä¹‰ä¸€ä¸ªæ–°çš„`Even-with-double`ï¼š

```pie
(claim Even-with-double
  (-> Nat U))
(define Even-with-double
  (Î» (n)
    (Î£ ((half Nat))
      (= Nat n (double half)))))
```

`Even-with-double`è¡¨è¾¾çš„æƒ³æ³•å’Œ`Even`æ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«åªåœ¨äºå‰è€…ç”¨çš„`double`å®ç°ï¼Œè€Œåè€…ç”¨çš„æ˜¯`+`ã€‚ç°åœ¨å¯¹åŸºäº`Even-with-double`çš„å‘½é¢˜`+two-even`çš„è¯æ˜å°±å˜å¾—ç®€å•äº†å¤šï¼š

```pie
(claim +two-even-with-double
  (Î  ((n Nat))
    (-> (Even-with-double n)
      (Even-with-double (+ 2 n)))))
(define +two-even-with-double
  (Î» (n)
    (Î» (even-n)
      (cons (add1 (car even-n))
        (cong (cdr even-n) (+ 2))))))
```

å¯ä»¥çœ‹åˆ°è¿™æ¬¡ä¸å†éœ€è¦ç”¨åˆ°`replace`ï¼Œå› ä¸ºæ ¹æ®å®šä¹‰ï¼Œ`(double (add1 half))`å¯ä»¥ç›´æ¥å˜ä¸º`(add1 (add1 (double half)))`ï¼Œè¿™æ ·è¡¨è¾¾å¼`(cong (cdr even-n) (+ 2))`çš„ç±»å‹ä¹Ÿå°±å’ŒæœŸæœ›çš„è¿”å›å€¼ç±»å‹ä¸€è‡´äº†ã€‚æ‰€ä»¥å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸åŒçš„å‘½é¢˜è¡¨è¾¾å½¢å¼ä¼šå½±å“åˆ°è¯æ˜çš„éš¾æ˜“ç¨‹åº¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé€‰æ‹©èƒ½è®©å‚æ•°â€œæ›´å¿«â€å¾—ç¼©å‡åˆ°æœ€ç®€å½¢å¼çš„å‡½æ•°æ¥å®šä¹‰å‘½é¢˜çš„è¯ï¼Œä¼šä½¿è¯æ˜æ›´ç®€å•ã€‚

## ç»“å°¾

åˆ°è¿™é‡Œæœ¬æ–‡å¯¹ Pie è¯­è¨€ä¸­çš„å®šç†è¯æ˜çš„ä»‹ç»å·²ç»å®Œç»“ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿæ¥è¿‘å°¾å£°äº†ã€‚å…¶å®æœ€å¼€å§‹åªæ˜¯æƒ³å†™ä¸€ç¯‡ã€ŠThe Little Typerã€‹çš„è¯»åæ„Ÿï¼Œç»“æœæ…¢æ…¢åœ°å‘å±•ï¼ˆå•°å—¦ï¼‰åˆ°äº†è¿™ä¹ˆé•¿ã€‚å¦‚æœè¯»è¿‡æœ¬æ–‡å‡èµ·äº†ä¸€ä¸å¯¹ä¾èµ–ç±»å‹æˆ–å®šç†è¯æ˜çš„å…´è¶£ï¼Œå¼ºçƒˆæ¨èç»§ç»­è¯»ä¸€ä¸‹ã€ŠThe Little Typerã€‹è¿™æœ¬ä¹¦ï¼Œå®ƒè¿œæ¯”æœ¬æ–‡æœ‰è¶£çš„å¤šï¼Œè€Œä¸”è¿˜æœ‰å¾ˆå¤šæœ‰æ„æ€çš„æ¦‚å¿µè¿™é‡Œé™äºç¯‡å¹…ä¹Ÿæ²¡åŠæ³•ä¸€ä¸€ä»‹ç»ã€‚å¦‚æœæƒ³äº†è§£ä¾èµ–ç±»å‹çš„ä¸€äº›æ›´â€œå®é™…â€çš„åº”ç”¨åœºæ™¯ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æœ¬æ–‡å¼€å¤´æ‰€æçš„ Idris è¯­è¨€ï¼Œä»¥åŠè¯¥è¯­è¨€ä½œè€…çš„ä¹¦ã€ŠType-Driven Development with Idrisã€‹ã€‚å¦å¤–ï¼Œå¦‚æœæƒ³ä»æ›´ç†è®ºçš„æ–¹å‘æŒæ¡å®šç†è¯æ˜çš„è¯ï¼Œè¿™æœ¬åœ¨çº¿çš„æ•™ç§‘ä¹¦[ã€ŠSoftware Foundationsã€‹](https://softwarefoundations.cis.upenn.edu/current/index.html)ï¼Œä»¥åŠé…å¥—çš„ç¼–ç¨‹è¯­è¨€ [Coq](https://coq.inria.fr/) ä¼šæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

[^1]: ç±»å‹å¯ä»¥å‡ºç°åœ¨æ™®é€šçš„è¡¨è¾¾å¼ä¸­ï¼Œæ¯”å¦‚å¯ä»¥æŠŠç±»å‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œå‡½æ•°ä¹Ÿå¯ä»¥æŠŠç±»å‹åƒå€¼ä¸€æ ·è¿”å›ã€‚
[^2]: æ¯”å¦‚è‘—åçš„[å››è‰²å®šç†](https://en.wikipedia.org/wiki/Four_color_theorem)çš„è¯æ˜å°±æ˜¯åœ¨ 1976 å¹´ç”±è®¡ç®—æœºçš„å®šç†è¯æ˜ç¨‹åºæ¥è¾…åŠ©æ¨å¯¼å¾—å‡ºçš„ã€‚
[^3]: åœ¨ DrRacket ä¸­å¯ä»¥é€šè¿‡å¿«æ·é”® âŒ˜-\ è¾“å…¥å­—æ¯ Î»ã€‚
[^4]: `::` è¯»ä½œ consï¼ˆ/ËˆkÉ‘nz/ï¼‰ï¼Œç»§æ‰¿è‡ª Lisp è¯­è¨€ã€‚
[^5]:
    å¯ä»¥é€šè¿‡ä¸‹å›¾çš„èœå•å¯¼å…¥[è¿™ä¸ªæ–‡ä»¶](/static/images/dt/keybindings.rkt)ï¼Œä¹‹åå°±å¯ä»¥ç›´æ¥åœ¨ DrRacket é‡ŒæŒ‰ Ctrl-[ è¾“å…¥å­—æ¯ Î ã€‚
    ![keybind](/static/images/dt/keybind.png)

[^6]: å…³äº parameter å’Œ index çš„æ›´è¯¦ç»†å‡†ç¡®çš„åŒºåˆ«å¯ä»¥å‚è€ƒ [stackoverflow ä¸Šçš„è¿™ä¸ªé—®é¢˜](https://stackoverflow.com/questions/24600256/difference-between-type-parameters-and-indices)ã€‚
[^7]: motive è¿™ä¸ªåå­—åº”è¯¥æ˜¯æ¥è‡ª[è¿™ç¯‡è®ºæ–‡](http://www.cs.ru.nl/F.Wiedijk/courses/tt-2010/tvftl/conor-elimination.pdf)ã€‚
[^8]: [ã€Šè®¡ç®—è¿›åŒ–å²ã€‹](https://book.douban.com/subject/26975991/)è¿™æœ¬ä¹¦é‡Œæœ‰æ¯”è¾ƒæ·±å…¥çš„å…³äºè¿™æ–¹é¢çš„è®¨è®ºã€‚
[^9]: å¦‚æœå·²ç»å¯¼å…¥äº†è„šæ³¨ 5 ä¸­çš„æ–‡ä»¶çš„è¯ï¼Œå¯ä»¥åœ¨ DrRacket é‡ŒæŒ‰ Ctrl-] æ¥è¾“å…¥å­—æ¯ Î£ã€‚
